                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module player
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _playSound
                                     11 	.globl _hideSprite4
                                     12 	.globl _moveSprite4
                                     13 	.globl _joypad
                                     14 	.globl _player
                                     15 	.globl _initPlayer
                                     16 	.globl _updatePlayerInput
                                     17 	.globl _updatePlayerPhysics
                                     18 	.globl _updatePlayerAnimation
                                     19 	.globl _drawPlayer
                                     20 ;--------------------------------------------------------
                                     21 ; special function registers
                                     22 ;--------------------------------------------------------
                                     23 ;--------------------------------------------------------
                                     24 ; ram data
                                     25 ;--------------------------------------------------------
                                     26 	.area _DATA
    00000000                         27 _player::
    00000000                         28 	.ds 8
                                     29 ;--------------------------------------------------------
                                     30 ; ram data
                                     31 ;--------------------------------------------------------
                                     32 	.area _INITIALIZED
                                     33 ;--------------------------------------------------------
                                     34 ; absolute external ram data
                                     35 ;--------------------------------------------------------
                                     36 	.area _DABS (ABS)
                                     37 ;--------------------------------------------------------
                                     38 ; global & static initialisations
                                     39 ;--------------------------------------------------------
                                     40 	.area _HOME
                                     41 	.area _GSINIT
                                     42 	.area _GSFINAL
                                     43 	.area _GSINIT
                                     44 ;--------------------------------------------------------
                                     45 ; Home
                                     46 ;--------------------------------------------------------
                                     47 	.area _HOME
                                     48 	.area _HOME
                                     49 ;--------------------------------------------------------
                                     50 ; code
                                     51 ;--------------------------------------------------------
                                     52 	.area _CODE
                                     53 ;src/player.c:9: void initPlayer(void)
                                     54 ;	---------------------------------
                                     55 ; Function initPlayer
                                     56 ; ---------------------------------
    00000000                         57 _initPlayer::
                                     58 ;src/player.c:11: player.x = PLAYER_START_X;
    00000000 21r00r00         [12]   59 	ld	hl, #_player
                                     60 ;src/player.c:12: player.y = PLAYER_START_Y;
    00000003 3E 0A            [ 8]   61 	ld	a, #0x0a
    00000005 22               [ 8]   62 	ld	(hl+), a
    00000006 36 69            [12]   63 	ld	(hl), #0x69
                                     64 ;src/player.c:13: player.isJumping = 0;
    00000008 21r03r00         [12]   65 	ld	hl, #_player + 3
    0000000B 36 00            [12]   66 	ld	(hl), #0x00
                                     67 ;src/player.c:14: player.velocityY = 0;
    0000000D 21r02r00         [12]   68 	ld	hl, #_player + 2
    00000010 36 00            [12]   69 	ld	(hl), #0x00
                                     70 ;src/player.c:15: player.animCounter = 0;
    00000012 21r04r00         [12]   71 	ld	hl, #_player + 4
    00000015 36 00            [12]   72 	ld	(hl), #0x00
                                     73 ;src/player.c:16: player.currentFrame = 0;
    00000017 21r05r00         [12]   74 	ld	hl, #_player + 5
    0000001A 36 00            [12]   75 	ld	(hl), #0x00
                                     76 ;src/player.c:17: player.invincibilityTimer = 0;
    0000001C 21r06r00         [12]   77 	ld	hl, #_player + 6
    0000001F 36 00            [12]   78 	ld	(hl), #0x00
                                     79 ;src/player.c:18: player.flashTimer = 0;
    00000021 21r07r00         [12]   80 	ld	hl, #_player + 7
    00000024 36 00            [12]   81 	ld	(hl), #0x00
                                     82 ;src/player.c:19: }
    00000026 C9               [16]   83 	ret
                                     84 ;src/player.c:22: void updatePlayerInput(UINT8 joy)
                                     85 ;	---------------------------------
                                     86 ; Function updatePlayerInput
                                     87 ; ---------------------------------
    00000027                         88 _updatePlayerInput::
    00000027 4F               [ 4]   89 	ld	c, a
                                     90 ;src/player.c:24: if (joy & J_LEFT)
    00000028 CB 49            [ 8]   91 	bit	1, c
    0000002A 28 0B            [12]   92 	jr	Z, 00104$
                                     93 ;src/player.c:26: UINT8 nextX = player.x - PLAYER_SPEED;
    0000002C 11r00r00         [12]   94 	ld	de, #_player+0
    0000002F 1A               [ 8]   95 	ld	a, (de)
    00000030 3D               [ 4]   96 	dec	a
    00000031 3D               [ 4]   97 	dec	a
                                     98 ;src/player.c:27: if (nextX >= 5)
    00000032 FE 05            [ 8]   99 	cp	a, #0x05
    00000034 38 01            [12]  100 	jr	C, 00104$
                                    101 ;src/player.c:29: player.x = nextX;
    00000036 12               [ 8]  102 	ld	(de), a
    00000037                        103 00104$:
                                    104 ;src/player.c:32: if (joy & J_RIGHT)
    00000037 CB 41            [ 8]  105 	bit	0, c
    00000039 28 0B            [12]  106 	jr	Z, 00108$
                                    107 ;src/player.c:34: UINT8 nextX = player.x + PLAYER_SPEED;
    0000003B 11r00r00         [12]  108 	ld	de, #_player+0
    0000003E 1A               [ 8]  109 	ld	a, (de)
    0000003F C6 02            [ 8]  110 	add	a, #0x02
                                    111 ;src/player.c:35: if (nextX <= 145)
    00000041 FE 92            [ 8]  112 	cp	a, #0x92
    00000043 30 01            [12]  113 	jr	NC, 00108$
                                    114 ;src/player.c:37: player.x = nextX;
    00000045 12               [ 8]  115 	ld	(de), a
    00000046                        116 00108$:
                                    117 ;src/player.c:41: if ((joy & J_B) && !player.isJumping)
    00000046 CB 69            [ 8]  118 	bit	5, c
    00000048 C8               [20]  119 	ret	Z
    00000049 21r03r00         [12]  120 	ld	hl, #_player + 3
    0000004C 7E               [ 8]  121 	ld	a, (hl)
    0000004D B7               [ 4]  122 	or	a, a
    0000004E C0               [20]  123 	ret	NZ
                                    124 ;src/player.c:43: player.isJumping = 1;
    0000004F 36 01            [12]  125 	ld	(hl), #0x01
                                    126 ;src/player.c:44: player.velocityY = JUMP_STRENGTH;
    00000051 21r02r00         [12]  127 	ld	hl, #_player + 2
    00000054 36 0F            [12]  128 	ld	(hl), #0x0f
                                    129 ;src/player.c:45: playSound(SOUND_JUMP);
    00000056 3E 01            [ 8]  130 	ld	a, #0x01
                                    131 ;src/player.c:47: }
    00000058 C3r00r00         [16]  132 	jp	_playSound
                                    133 ;src/player.c:50: void updatePlayerPhysics(void)
                                    134 ;	---------------------------------
                                    135 ; Function updatePlayerPhysics
                                    136 ; ---------------------------------
    0000005B                        137 _updatePlayerPhysics::
                                    138 ;src/player.c:52: if (player.isJumping)
    0000005B FAr03r00         [16]  139 	ld	a, (#(_player + 3) + 0)
    0000005E B7               [ 4]  140 	or	a, a
    0000005F C8               [20]  141 	ret	Z
                                    142 ;src/player.c:54: player.velocityY += GRAVITY;
    00000060 01r02r00         [12]  143 	ld	bc, #_player + 2
    00000063 0A               [ 8]  144 	ld	a, (bc)
    00000064 C6 FE            [ 8]  145 	add	a, #0xfe
    00000066 5F               [ 4]  146 	ld	e, a
    00000067 02               [ 8]  147 	ld	(bc), a
                                    148 ;src/player.c:55: player.y -= player.velocityY;
    00000068 21r01r00         [12]  149 	ld	hl, #_player + 1
    0000006B 7E               [ 8]  150 	ld	a, (hl)
    0000006C 93               [ 4]  151 	sub	a, e
                                    152 ;src/player.c:57: if (player.y >= FLOOR_Y)
    0000006D 77               [ 8]  153 	ld	(hl), a
    0000006E D6 69            [ 8]  154 	sub	a, #0x69
    00000070 D8               [20]  155 	ret	C
                                    156 ;src/player.c:59: player.y = FLOOR_Y;
    00000071 36 69            [12]  157 	ld	(hl), #0x69
                                    158 ;src/player.c:60: player.isJumping = 0;
    00000073 21r03r00         [12]  159 	ld	hl, #(_player + 3)
    00000076 36 00            [12]  160 	ld	(hl), #0x00
                                    161 ;src/player.c:61: player.velocityY = 0;
    00000078 AF               [ 4]  162 	xor	a, a
    00000079 02               [ 8]  163 	ld	(bc), a
                                    164 ;src/player.c:64: }
    0000007A C9               [16]  165 	ret
                                    166 ;src/player.c:67: void updatePlayerAnimation(void)
                                    167 ;	---------------------------------
                                    168 ; Function updatePlayerAnimation
                                    169 ; ---------------------------------
    0000007B                        170 _updatePlayerAnimation::
                                    171 ;src/player.c:69: if (player.invincibilityTimer > 0)
    0000007B 21r06r00         [12]  172 	ld	hl, #_player + 6
    0000007E 7E               [ 8]  173 	ld	a, (hl)
    0000007F B7               [ 4]  174 	or	a, a
    00000080 28 11            [12]  175 	jr	Z, 00104$
                                    176 ;src/player.c:71: player.invincibilityTimer--;
    00000082 3D               [ 4]  177 	dec	a
    00000083 77               [ 8]  178 	ld	(hl), a
                                    179 ;src/player.c:72: player.flashTimer++;
    00000084 21r07r00         [12]  180 	ld	hl, #_player + 7
    00000087 34               [12]  181 	inc	(hl)
    00000088 7E               [ 8]  182 	ld	a, (hl)
                                    183 ;src/player.c:74: if (player.flashTimer % 4 < 2)
    00000089 E6 03            [ 8]  184 	and	a, #0x03
    0000008B D6 02            [ 8]  185 	sub	a, #0x02
    0000008D 30 04            [12]  186 	jr	NC, 00104$
                                    187 ;src/player.c:76: hideSprite4(0);
    0000008F AF               [ 4]  188 	xor	a, a
                                    189 ;src/player.c:77: return;
    00000090 C3r00r00         [16]  190 	jp	_hideSprite4
    00000093                        191 00104$:
                                    192 ;src/player.c:81: player.animCounter++;
    00000093 21r04r00         [12]  193 	ld	hl, #_player + 4
    00000096 34               [12]  194 	inc	(hl)
    00000097 7E               [ 8]  195 	ld	a, (hl)
                                    196 ;src/player.c:82: if (player.animCounter >= ANIM_SPEED)
    00000098 D6 0A            [ 8]  197 	sub	a, #0x0a
    0000009A D8               [20]  198 	ret	C
                                    199 ;src/player.c:84: player.animCounter = 0;
    0000009B 36 00            [12]  200 	ld	(hl), #0x00
                                    201 ;src/player.c:86: if ((joypad() & (J_LEFT | J_RIGHT)))
    0000009D CDr00r00         [24]  202 	call	_joypad
    000000A0 E6 03            [ 8]  203 	and	a, #0x03
    000000A2 C8               [20]  204 	ret	Z
                                    205 ;src/player.c:88: player.currentFrame = !player.currentFrame;
    000000A3 01r05r00         [12]  206 	ld	bc, #_player + 5
    000000A6 0A               [ 8]  207 	ld	a, (bc)
    000000A7 D6 01            [ 8]  208 	sub	a, #0x01
    000000A9 3E 00            [ 8]  209 	ld	a, #0x00
    000000AB 17               [ 4]  210 	rla
    000000AC 02               [ 8]  211 	ld	(bc), a
                                    212 ;src/player.c:90: if (player.currentFrame)
    000000AD B7               [ 4]  213 	or	a, a
    000000AE 28 15            [12]  214 	jr	Z, 00106$
                                    215 ;c:\gbdk\include\gb\gb.h:1887: shadow_OAM[nb].tile=tile;
    000000B0 21r02r00         [12]  216 	ld	hl, #(_shadow_OAM + 2)
    000000B3 36 04            [12]  217 	ld	(hl), #0x04
    000000B5 21r06r00         [12]  218 	ld	hl, #(_shadow_OAM + 6)
    000000B8 36 06            [12]  219 	ld	(hl), #0x06
    000000BA 21r0Ar00         [12]  220 	ld	hl, #(_shadow_OAM + 10)
    000000BD 36 05            [12]  221 	ld	(hl), #0x05
    000000BF 21r0Er00         [12]  222 	ld	hl, #(_shadow_OAM + 14)
    000000C2 36 07            [12]  223 	ld	(hl), #0x07
                                    224 ;src/player.c:95: set_sprite_tile(3, 7);
    000000C4 C9               [16]  225 	ret
    000000C5                        226 00106$:
                                    227 ;c:\gbdk\include\gb\gb.h:1887: shadow_OAM[nb].tile=tile;
    000000C5 21r02r00         [12]  228 	ld	hl, #(_shadow_OAM + 2)
    000000C8 36 00            [12]  229 	ld	(hl), #0x00
    000000CA 21r06r00         [12]  230 	ld	hl, #(_shadow_OAM + 6)
    000000CD 36 02            [12]  231 	ld	(hl), #0x02
    000000CF 21r0Ar00         [12]  232 	ld	hl, #(_shadow_OAM + 10)
    000000D2 36 01            [12]  233 	ld	(hl), #0x01
    000000D4 21r0Er00         [12]  234 	ld	hl, #(_shadow_OAM + 14)
    000000D7 36 03            [12]  235 	ld	(hl), #0x03
                                    236 ;src/player.c:102: set_sprite_tile(3, 3);
                                    237 ;src/player.c:106: }
    000000D9 C9               [16]  238 	ret
                                    239 ;src/player.c:109: void drawPlayer(void)
                                    240 ;	---------------------------------
                                    241 ; Function drawPlayer
                                    242 ; ---------------------------------
    000000DA                        243 _drawPlayer::
                                    244 ;src/player.c:111: moveSprite4(0, 1, 2, 3, player.x, player.y);
    000000DA FAr01r00         [16]  245 	ld	a, (#(_player + 1) + 0)
    000000DD 21r00r00         [12]  246 	ld	hl, #_player
    000000E0 4E               [ 8]  247 	ld	c, (hl)
    000000E1 06 00            [ 8]  248 	ld	b, #0x00
    000000E3 F5               [16]  249 	push	af
    000000E4 33               [ 8]  250 	inc	sp
    000000E5 C5               [16]  251 	push	bc
    000000E6 21 02 03         [12]  252 	ld	hl, #0x302
    000000E9 E5               [16]  253 	push	hl
    000000EA 1E 01            [ 8]  254 	ld	e, #0x01
    000000EC AF               [ 4]  255 	xor	a, a
    000000ED CDr00r00         [24]  256 	call	_moveSprite4
                                    257 ;src/player.c:112: }
    000000F0 C9               [16]  258 	ret
                                    259 	.area _CODE
                                    260 	.area _INITIALIZER
                                    261 	.area _CABS (ABS)
