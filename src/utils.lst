                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ISO C Compiler
                                      3 ; Version 4.5.1 #15267 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module utils
                                      6 	
                                      7 ;--------------------------------------------------------
                                      8 ; Public variables in this module
                                      9 ;--------------------------------------------------------
                                     10 	.globl _gbt_update
                                     11 	.globl _vsync
                                     12 	.globl _simpleRand
                                     13 	.globl _initRand
                                     14 	.globl _moveSprite4
                                     15 	.globl _hideSprite4
                                     16 	.globl _waitFrames
                                     17 	.globl _checkCollision
                                     18 ;--------------------------------------------------------
                                     19 ; special function registers
                                     20 ;--------------------------------------------------------
                                     21 ;--------------------------------------------------------
                                     22 ; ram data
                                     23 ;--------------------------------------------------------
                                     24 	.area _DATA
    00000000                         25 _randSeed:
    00000000                         26 	.ds 2
                                     27 ;--------------------------------------------------------
                                     28 ; ram data
                                     29 ;--------------------------------------------------------
                                     30 	.area _INITIALIZED
                                     31 ;--------------------------------------------------------
                                     32 ; absolute external ram data
                                     33 ;--------------------------------------------------------
                                     34 	.area _DABS (ABS)
                                     35 ;--------------------------------------------------------
                                     36 ; global & static initialisations
                                     37 ;--------------------------------------------------------
                                     38 	.area _HOME
                                     39 	.area _GSINIT
                                     40 	.area _GSFINAL
                                     41 	.area _GSINIT
                                     42 ;--------------------------------------------------------
                                     43 ; Home
                                     44 ;--------------------------------------------------------
                                     45 	.area _HOME
                                     46 	.area _HOME
                                     47 ;--------------------------------------------------------
                                     48 ; code
                                     49 ;--------------------------------------------------------
                                     50 	.area _CODE
                                     51 ;src/utils.c:9: UINT8 simpleRand(void)
                                     52 ;	---------------------------------
                                     53 ; Function simpleRand
                                     54 ; ---------------------------------
    00000000                         55 _simpleRand::
                                     56 ;src/utils.c:11: randSeed = (randSeed * 1103515245U + 12345U) & 0x7FFFU;
    00000000 FAr00r00         [16]   57 	ld	a, (_randSeed)
    00000003 4F               [ 4]   58 	ld	c, a
    00000004 21r01r00         [12]   59 	ld	hl, #_randSeed + 1
    00000007 46               [ 8]   60 	ld	b, (hl)
    00000008 69               [ 4]   61 	ld	l, c
    00000009 60               [ 4]   62 	ld	h, b
    0000000A 29               [ 8]   63 	add	hl, hl
    0000000B 29               [ 8]   64 	add	hl, hl
    0000000C 29               [ 8]   65 	add	hl, hl
    0000000D 09               [ 8]   66 	add	hl, bc
    0000000E 29               [ 8]   67 	add	hl, hl
    0000000F 09               [ 8]   68 	add	hl, bc
    00000010 29               [ 8]   69 	add	hl, hl
    00000011 09               [ 8]   70 	add	hl, bc
    00000012 29               [ 8]   71 	add	hl, hl
    00000013 29               [ 8]   72 	add	hl, hl
    00000014 29               [ 8]   73 	add	hl, hl
    00000015 09               [ 8]   74 	add	hl, bc
    00000016 29               [ 8]   75 	add	hl, hl
    00000017 09               [ 8]   76 	add	hl, bc
    00000018 29               [ 8]   77 	add	hl, hl
    00000019 29               [ 8]   78 	add	hl, hl
    0000001A 09               [ 8]   79 	add	hl, bc
    0000001B 29               [ 8]   80 	add	hl, hl
    0000001C 09               [ 8]   81 	add	hl, bc
    0000001D 29               [ 8]   82 	add	hl, hl
    0000001E 29               [ 8]   83 	add	hl, hl
    0000001F 09               [ 8]   84 	add	hl, bc
    00000020 01 39 30         [12]   85 	ld	bc, #0x3039
    00000023 09               [ 8]   86 	add	hl, bc
    00000024 7D               [ 4]   87 	ld	a, l
    00000025 EAr00r00         [16]   88 	ld	(_randSeed), a
    00000028 7C               [ 4]   89 	ld	a, h
    00000029 E6 7F            [ 8]   90 	and	a, #0x7f
    0000002B EAr01r00         [16]   91 	ld	(#_randSeed + 1),a
                                     92 ;src/utils.c:12: return (UINT8)(randSeed >> 8);
    0000002E FAr01r00         [16]   93 	ld	a, (_randSeed + 1)
                                     94 ;src/utils.c:13: }
    00000031 C9               [16]   95 	ret
                                     96 ;src/utils.c:16: void initRand(UINT16 seed)
                                     97 ;	---------------------------------
                                     98 ; Function initRand
                                     99 ; ---------------------------------
    00000032                        100 _initRand::
    00000032 21r00r00         [12]  101 	ld	hl, #_randSeed
    00000035 7B               [ 4]  102 	ld	a, e
    00000036 22               [ 8]  103 	ld	(hl+), a
    00000037 72               [ 8]  104 	ld	(hl), d
                                    105 ;src/utils.c:18: randSeed = seed;
                                    106 ;src/utils.c:19: }
    00000038 C9               [16]  107 	ret
                                    108 ;src/utils.c:22: void moveSprite4(UINT8 sprite1, UINT8 sprite2, UINT8 sprite3, UINT8 sprite4,
                                    109 ;	---------------------------------
                                    110 ; Function moveSprite4
                                    111 ; ---------------------------------
    00000039                        112 _moveSprite4::
    00000039 E8 FC            [16]  113 	add	sp, #-4
    0000003B F8 03            [12]  114 	ldhl	sp,	#3
    0000003D 32               [ 8]  115 	ld	(hl-), a
    0000003E 73               [ 8]  116 	ld	(hl), e
                                    117 ;src/utils.c:25: move_sprite(sprite1, x, y);
    0000003F F8 0A            [12]  118 	ldhl	sp,	#10
    00000041 3A               [ 8]  119 	ld	a, (hl-)
    00000042 2B               [ 8]  120 	dec	hl
    00000043 5F               [ 4]  121 	ld	e, a
    00000044 7E               [ 8]  122 	ld	a, (hl)
    00000045 F8 00            [12]  123 	ldhl	sp,	#0
    00000047 77               [ 8]  124 	ld	(hl), a
    00000048 4E               [ 8]  125 	ld	c, (hl)
                                    126 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    00000049 F8 03            [12]  127 	ldhl	sp,	#3
    0000004B 46               [ 8]  128 	ld	b, (hl)
    0000004C AF               [ 4]  129 	xor	a, a
    0000004D 68               [ 4]  130 	ld	l, b
    0000004E 67               [ 4]  131 	ld	h, a
    0000004F 29               [ 8]  132 	add	hl, hl
    00000050 29               [ 8]  133 	add	hl, hl
    00000051 D5               [16]  134 	push	de
    00000052 11r00r00         [12]  135 	ld	de, #_shadow_OAM
    00000055 19               [ 8]  136 	add	hl, de
    00000056 D1               [12]  137 	pop	de
                                    138 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    00000057 7B               [ 4]  139 	ld	a, e
    00000058 22               [ 8]  140 	ld	(hl+), a
    00000059 71               [ 8]  141 	ld	(hl), c
                                    142 ;src/utils.c:26: move_sprite(sprite2, x + SPRITE_SIZE, y);
    0000005A F8 08            [12]  143 	ldhl	sp,	#8
    0000005C 7E               [ 8]  144 	ld	a, (hl)
    0000005D C6 08            [ 8]  145 	add	a, #0x08
    0000005F 4F               [ 4]  146 	ld	c, a
    00000060 41               [ 4]  147 	ld	b, c
                                    148 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    00000061 F8 02            [12]  149 	ldhl	sp,	#2
    00000063 56               [ 8]  150 	ld	d, (hl)
    00000064 AF               [ 4]  151 	xor	a, a
    00000065 6A               [ 4]  152 	ld	l, d
    00000066 67               [ 4]  153 	ld	h, a
    00000067 29               [ 8]  154 	add	hl, hl
    00000068 29               [ 8]  155 	add	hl, hl
    00000069 D5               [16]  156 	push	de
    0000006A 11r00r00         [12]  157 	ld	de, #_shadow_OAM
    0000006D 19               [ 8]  158 	add	hl, de
    0000006E D1               [12]  159 	pop	de
                                    160 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    0000006F 7B               [ 4]  161 	ld	a, e
    00000070 22               [ 8]  162 	ld	(hl+), a
    00000071 70               [ 8]  163 	ld	(hl), b
                                    164 ;src/utils.c:27: move_sprite(sprite3, x, y + SPRITE_SIZE);
    00000072 7B               [ 4]  165 	ld	a, e
    00000073 C6 08            [ 8]  166 	add	a, #0x08
    00000075 47               [ 4]  167 	ld	b, a
    00000076 F8 01            [12]  168 	ldhl	sp,	#1
    00000078 70               [ 8]  169 	ld	(hl), b
    00000079 F8 06            [12]  170 	ldhl	sp,	#6
                                    171 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    0000007B 6E               [ 8]  172 	ld	l, (hl)
    0000007C 26 00            [ 8]  173 	ld	h, #0x00
    0000007E 29               [ 8]  174 	add	hl, hl
    0000007F 29               [ 8]  175 	add	hl, hl
    00000080 11r00r00         [12]  176 	ld	de, #_shadow_OAM
    00000083 19               [ 8]  177 	add	hl, de
    00000084 5D               [ 4]  178 	ld	e, l
    00000085 54               [ 4]  179 	ld	d, h
                                    180 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    00000086 F8 01            [12]  181 	ldhl	sp,	#1
    00000088 3A               [ 8]  182 	ld	a, (hl-)
    00000089 12               [ 8]  183 	ld	(de), a
    0000008A 13               [ 8]  184 	inc	de
    0000008B 7E               [ 8]  185 	ld	a, (hl)
    0000008C 12               [ 8]  186 	ld	(de), a
                                    187 ;src/utils.c:28: move_sprite(sprite4, x + SPRITE_SIZE, y + SPRITE_SIZE);
    0000008D F8 07            [12]  188 	ldhl	sp,	#7
                                    189 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    0000008F 6E               [ 8]  190 	ld	l, (hl)
    00000090 26 00            [ 8]  191 	ld	h, #0x00
    00000092 29               [ 8]  192 	add	hl, hl
    00000093 29               [ 8]  193 	add	hl, hl
    00000094 11r00r00         [12]  194 	ld	de, #_shadow_OAM
    00000097 19               [ 8]  195 	add	hl, de
                                    196 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    00000098 70               [ 8]  197 	ld	(hl), b
    00000099 23               [ 8]  198 	inc	hl
    0000009A 71               [ 8]  199 	ld	(hl), c
                                    200 ;src/utils.c:28: move_sprite(sprite4, x + SPRITE_SIZE, y + SPRITE_SIZE);
                                    201 ;src/utils.c:29: }
    0000009B E8 04            [16]  202 	add	sp, #4
    0000009D E1               [12]  203 	pop	hl
    0000009E E8 05            [16]  204 	add	sp, #5
    000000A0 E9               [ 4]  205 	jp	(hl)
                                    206 ;src/utils.c:32: void hideSprite4(UINT8 base)
                                    207 ;	---------------------------------
                                    208 ; Function hideSprite4
                                    209 ; ---------------------------------
    000000A1                        210 _hideSprite4::
    000000A1 5F               [ 4]  211 	ld	e, a
                                    212 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    000000A2 01r00r00         [12]  213 	ld	bc, #_shadow_OAM+0
    000000A5 6B               [ 4]  214 	ld	l, e
    000000A6 AF               [ 4]  215 	xor	a, a
    000000A7 67               [ 4]  216 	ld	h, a
    000000A8 29               [ 8]  217 	add	hl, hl
    000000A9 29               [ 8]  218 	add	hl, hl
    000000AA 09               [ 8]  219 	add	hl, bc
                                    220 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    000000AB 3E C8            [ 8]  221 	ld	a, #0xc8
    000000AD 22               [ 8]  222 	ld	(hl+), a
    000000AE 36 C8            [12]  223 	ld	(hl), #0xc8
                                    224 ;src/utils.c:35: move_sprite(base + 1, OFFSCREEN_X, OFFSCREEN_Y);
    000000B0 53               [ 4]  225 	ld	d, e
    000000B1 14               [ 4]  226 	inc	d
                                    227 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    000000B2 01r00r00         [12]  228 	ld	bc, #_shadow_OAM+0
    000000B5 6A               [ 4]  229 	ld	l, d
    000000B6 26 00            [ 8]  230 	ld	h, #0x00
    000000B8 29               [ 8]  231 	add	hl, hl
    000000B9 29               [ 8]  232 	add	hl, hl
    000000BA 09               [ 8]  233 	add	hl, bc
                                    234 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    000000BB 3E C8            [ 8]  235 	ld	a, #0xc8
    000000BD 22               [ 8]  236 	ld	(hl+), a
    000000BE 36 C8            [12]  237 	ld	(hl), #0xc8
                                    238 ;src/utils.c:36: move_sprite(base + 2, OFFSCREEN_X, OFFSCREEN_Y);
    000000C0 53               [ 4]  239 	ld	d, e
    000000C1 14               [ 4]  240 	inc	d
    000000C2 14               [ 4]  241 	inc	d
                                    242 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    000000C3 01r00r00         [12]  243 	ld	bc, #_shadow_OAM+0
    000000C6 6A               [ 4]  244 	ld	l, d
    000000C7 26 00            [ 8]  245 	ld	h, #0x00
    000000C9 29               [ 8]  246 	add	hl, hl
    000000CA 29               [ 8]  247 	add	hl, hl
    000000CB 09               [ 8]  248 	add	hl, bc
                                    249 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    000000CC 3E C8            [ 8]  250 	ld	a, #0xc8
    000000CE 22               [ 8]  251 	ld	(hl+), a
    000000CF 36 C8            [12]  252 	ld	(hl), #0xc8
                                    253 ;src/utils.c:37: move_sprite(base + 3, OFFSCREEN_X, OFFSCREEN_Y);
    000000D1 1C               [ 4]  254 	inc	e
    000000D2 1C               [ 4]  255 	inc	e
    000000D3 1C               [ 4]  256 	inc	e
                                    257 ;c:\gbdk\include\gb\gb.h:1973: OAM_item_t * itm = &shadow_OAM[nb];
    000000D4 01r00r00         [12]  258 	ld	bc, #_shadow_OAM+0
    000000D7 AF               [ 4]  259 	xor	a, a
    000000D8 6B               [ 4]  260 	ld	l, e
    000000D9 67               [ 4]  261 	ld	h, a
    000000DA 29               [ 8]  262 	add	hl, hl
    000000DB 29               [ 8]  263 	add	hl, hl
    000000DC 09               [ 8]  264 	add	hl, bc
                                    265 ;c:\gbdk\include\gb\gb.h:1974: itm->y=y, itm->x=x;
    000000DD 3E C8            [ 8]  266 	ld	a, #0xc8
    000000DF 22               [ 8]  267 	ld	(hl+), a
    000000E0 36 C8            [12]  268 	ld	(hl), #0xc8
                                    269 ;src/utils.c:37: move_sprite(base + 3, OFFSCREEN_X, OFFSCREEN_Y);
                                    270 ;src/utils.c:38: }
    000000E2 C9               [16]  271 	ret
                                    272 ;src/utils.c:41: void waitFrames(UINT8 frames)
                                    273 ;	---------------------------------
                                    274 ; Function waitFrames
                                    275 ; ---------------------------------
    000000E3                        276 _waitFrames::
    000000E3 4F               [ 4]  277 	ld	c, a
                                    278 ;src/utils.c:44: for (i = 0; i < frames; i++)
    000000E4 06 00            [ 8]  279 	ld	b, #0x00
    000000E6                        280 00103$:
    000000E6 78               [ 4]  281 	ld	a, b
    000000E7 91               [ 4]  282 	sub	a, c
    000000E8 D0               [20]  283 	ret	NC
                                    284 ;src/utils.c:46: vsync();
    000000E9 CDr00r00         [24]  285 	call	_vsync
                                    286 ;src/utils.c:47: gbt_update();
    000000EC C5               [16]  287 	push	bc
    000000ED CDr00r00         [24]  288 	call	_gbt_update
    000000F0 C1               [12]  289 	pop	bc
                                    290 ;src/utils.c:44: for (i = 0; i < frames; i++)
    000000F1 04               [ 4]  291 	inc	b
                                    292 ;src/utils.c:49: }
    000000F2 18 F2            [12]  293 	jr	00103$
                                    294 ;src/utils.c:52: UINT8 checkCollision(UINT8 x1, UINT8 y1, UINT8 w1, UINT8 h1,
                                    295 ;	---------------------------------
                                    296 ; Function checkCollision
                                    297 ; ---------------------------------
    000000F4                        298 _checkCollision::
    000000F4 E8 FB            [16]  299 	add	sp, #-5
    000000F6 57               [ 4]  300 	ld	d, a
    000000F7 F8 04            [12]  301 	ldhl	sp,	#4
    000000F9 73               [ 8]  302 	ld	(hl), e
                                    303 ;src/utils.c:55: return (x1 < x2 + w2 && x1 + w1 > x2 &&
    000000FA F8 09            [12]  304 	ldhl	sp,	#9
    000000FC 7E               [ 8]  305 	ld	a, (hl)
    000000FD F8 00            [12]  306 	ldhl	sp,	#0
    000000FF 22               [ 8]  307 	ld	(hl+), a
    00000100 36 00            [12]  308 	ld	(hl), #0x00
    00000102 F8 0B            [12]  309 	ldhl	sp,	#11
    00000104 4E               [ 8]  310 	ld	c, (hl)
    00000105 06 00            [ 8]  311 	ld	b, #0x00
    00000107 E1               [12]  312 	pop	hl
    00000108 E5               [16]  313 	push	hl
    00000109 09               [ 8]  314 	add	hl, bc
    0000010A 4D               [ 4]  315 	ld	c, l
    0000010B 44               [ 4]  316 	ld	b, h
    0000010C F8 02            [12]  317 	ldhl	sp,	#2
    0000010E 7A               [ 4]  318 	ld	a, d
    0000010F 22               [ 8]  319 	ld	(hl+), a
    00000110 AF               [ 4]  320 	xor	a, a
    00000111 32               [ 8]  321 	ld	(hl-), a
    00000112 2A               [ 8]  322 	ld	a, (hl+)
    00000113 91               [ 4]  323 	sub	a, c
    00000114 7E               [ 8]  324 	ld	a, (hl)
    00000115 98               [ 4]  325 	sbc	a, b
    00000116 30 49            [12]  326 	jr	NC, 00103$
    00000118 F8 07            [12]  327 	ldhl	sp,	#7
    0000011A 4E               [ 8]  328 	ld	c, (hl)
    0000011B 06 00            [ 8]  329 	ld	b, #0x00
    0000011D F8 02            [12]  330 	ldhl	sp,	#2
    0000011F 2A               [ 8]  331 	ld	a,	(hl+)
    00000120 66               [ 8]  332 	ld	h, (hl)
    00000121 6F               [ 4]  333 	ld	l, a
    00000122 09               [ 8]  334 	add	hl, bc
    00000123 4D               [ 4]  335 	ld	c, l
    00000124 44               [ 4]  336 	ld	b, h
    00000125 F8 00            [12]  337 	ldhl	sp,	#0
    00000127 2A               [ 8]  338 	ld	a, (hl+)
    00000128 91               [ 4]  339 	sub	a, c
    00000129 7E               [ 8]  340 	ld	a, (hl)
    0000012A 98               [ 4]  341 	sbc	a, b
    0000012B 30 34            [12]  342 	jr	NC, 00103$
                                    343 ;src/utils.c:56: y1 < y2 + h2 && y1 + h1 > y2);
    0000012D F8 0A            [12]  344 	ldhl	sp,	#10
    0000012F 7E               [ 8]  345 	ld	a, (hl)
    00000130 F8 00            [12]  346 	ldhl	sp,	#0
    00000132 22               [ 8]  347 	ld	(hl+), a
    00000133 36 00            [12]  348 	ld	(hl), #0x00
    00000135 F8 0C            [12]  349 	ldhl	sp,	#12
    00000137 4E               [ 8]  350 	ld	c, (hl)
    00000138 06 00            [ 8]  351 	ld	b, #0x00
    0000013A E1               [12]  352 	pop	hl
    0000013B E5               [16]  353 	push	hl
    0000013C 09               [ 8]  354 	add	hl, bc
    0000013D 4D               [ 4]  355 	ld	c, l
    0000013E 44               [ 4]  356 	ld	b, h
    0000013F F8 04            [12]  357 	ldhl	sp,	#4
    00000141 3A               [ 8]  358 	ld	a, (hl-)
    00000142 2B               [ 8]  359 	dec	hl
    00000143 22               [ 8]  360 	ld	(hl+), a
    00000144 AF               [ 4]  361 	xor	a, a
    00000145 32               [ 8]  362 	ld	(hl-), a
    00000146 2A               [ 8]  363 	ld	a, (hl+)
    00000147 91               [ 4]  364 	sub	a, c
    00000148 7E               [ 8]  365 	ld	a, (hl)
    00000149 98               [ 4]  366 	sbc	a, b
    0000014A 30 15            [12]  367 	jr	NC, 00103$
    0000014C F8 08            [12]  368 	ldhl	sp,	#8
    0000014E 4E               [ 8]  369 	ld	c, (hl)
    0000014F 06 00            [ 8]  370 	ld	b, #0x00
    00000151 F8 02            [12]  371 	ldhl	sp,	#2
    00000153 2A               [ 8]  372 	ld	a,	(hl+)
    00000154 66               [ 8]  373 	ld	h, (hl)
    00000155 6F               [ 4]  374 	ld	l, a
    00000156 09               [ 8]  375 	add	hl, bc
    00000157 4D               [ 4]  376 	ld	c, l
    00000158 44               [ 4]  377 	ld	b, h
    00000159 F8 00            [12]  378 	ldhl	sp,	#0
    0000015B 2A               [ 8]  379 	ld	a, (hl+)
    0000015C 91               [ 4]  380 	sub	a, c
    0000015D 7E               [ 8]  381 	ld	a, (hl)
    0000015E 98               [ 4]  382 	sbc	a, b
    0000015F 38 03            [12]  383 	jr	C, 00104$
    00000161                        384 00103$:
    00000161 AF               [ 4]  385 	xor	a, a
    00000162 18 02            [12]  386 	jr	00105$
    00000164                        387 00104$:
    00000164 3E 01            [ 8]  388 	ld	a, #0x01
    00000166                        389 00105$:
                                    390 ;src/utils.c:57: }
    00000166 E8 05            [16]  391 	add	sp, #5
    00000168 E1               [12]  392 	pop	hl
    00000169 E8 06            [16]  393 	add	sp, #6
    0000016B E9               [ 4]  394 	jp	(hl)
                                    395 	.area _CODE
                                    396 	.area _INITIALIZER
                                    397 	.area _CABS (ABS)
