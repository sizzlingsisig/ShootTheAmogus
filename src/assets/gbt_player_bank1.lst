                                      1 ;-------------------------------------------------------------------------------
                                      2 ;
                                      3 ; GBT Player v2.1.3
                                      4 ;
                                      5 ; SPDX-License-Identifier: MIT
                                      6 ;
                                      7 ; Copyright (c) 2009-2020, Antonio Niño Díaz <antonio_nd@outlook.com>
                                      8 ;
                                      9 ;-------------------------------------------------------------------------------
                                     10 
                         0000FF10    11 	.NR10 = 0xFF10
                         0000FF11    12 	.NR11 = 0xFF11
                         0000FF12    13 	.NR12 = 0xFF12
                         0000FF13    14 	.NR13 = 0xFF13
                         0000FF14    15 	.NR14 = 0xFF14
                         0000FF16    16 	.NR21 = 0xFF16
                         0000FF17    17 	.NR22 = 0xFF17
                         0000FF18    18 	.NR23 = 0xFF18
                         0000FF19    19 	.NR24 = 0xFF19
                         0000FF1A    20 	.NR30 = 0xFF1A
                         0000FF1B    21 	.NR31 = 0xFF1B
                         0000FF1C    22 	.NR32 = 0xFF1C
                         0000FF1D    23 	.NR33 = 0xFF1D
                         0000FF1E    24 	.NR34 = 0xFF1E
                         0000FF20    25 	.NR41 = 0xFF20
                         0000FF21    26 	.NR42 = 0xFF21
                         0000FF22    27 	.NR43 = 0xFF22
                         0000FF23    28 	.NR44 = 0xFF23
                         0000FF24    29 	.NR50 = 0xFF24
                         0000FF25    30 	.NR51 = 0xFF25
                         0000FF26    31 	.NR52 = 0xFF26
                                     32 
                                     33 ;-------------------------------------------------------------------------------
                                     34 
                                     35 	.area	_CODE_1
                                     36 
                                     37 ;-------------------------------------------------------------------------------
                                     38 
    00000000                         39 gbt_wave: ; 8 sounds
    00000000 A5 D7 C9 E1 BC 9A 76    40 	.DB	0xA5,0xD7,0xC9,0xE1,0xBC,0x9A,0x76,0x31,0x0C,0xBA,0xDE,0x60,0x1B,0xCA,0x03,0x93 ; random :P
             31 0C BA DE 60 1B CA
             03 93
    00000010 F0 E1 D2 C3 B4 A5 96    41 	.DB	0xF0,0xE1,0xD2,0xC3,0xB4,0xA5,0x96,0x87,0x78,0x69,0x5A,0x4B,0x3C,0x2D,0x1E,0x0F
             87 78 69 5A 4B 3C 2D
             1E 0F
    00000020 FD EC DB CA B9 A8 97    42 	.DB	0xFD,0xEC,0xDB,0xCA,0xB9,0xA8,0x97,0x86,0x79,0x68,0x57,0x46,0x35,0x24,0x13,0x02 ; little up-downs
             86 79 68 57 46 35 24
             13 02
    00000030 DE FE DC BA 9A A9 87    43 	.DB	0xDE,0xFE,0xDC,0xBA,0x9A,0xA9,0x87,0x77,0x88,0x87,0x65,0x56,0x54,0x32,0x10,0x12
             77 88 87 65 56 54 32
             10 12
    00000040 AB CD EF ED CB A0 12    44 	.DB	0xAB,0xCD,0xEF,0xED,0xCB,0xA0,0x12,0x3E,0xDC,0xBA,0xBC,0xDE,0xFE,0xDC,0x32,0x10 ; triangular broken
             3E DC BA BC DE FE DC
             32 10
    00000050 FF EE DD CC BB AA 99    45 	.DB	0xFF,0xEE,0xDD,0xCC,0xBB,0xAA,0x99,0x88,0x77,0x66,0x55,0x44,0x33,0x22,0x11,0x00 ; triangular
             88 77 66 55 44 33 22
             11 00
    00000060 FF FF FF FF FF FF FF    46 	.DB	0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00 ; square 50%
             FF 00 00 00 00 00 00
             00 00
    00000070 79 BC DE EF FF EE DC    47 	.DB	0x79,0xBC,0xDE,0xEF,0xFF,0xEE,0xDC,0xB9,0x75,0x43,0x21,0x10,0x00,0x11,0x23,0x45 ; sine
             B9 75 43 21 10 00 11
             23 45
                                     48 
    00000080                         49 gbt_noise: ; 16 sounds
                                     50 	; 7 bit
    00000080 5F 5B 4B 2F 3B 58 1F    51 	.DB	0x5F,0x5B,0x4B,0x2F,0x3B,0x58,0x1F,0x0F
             0F
                                     52 	; 15 bit
    00000088 90 80 70 50 00          53 	.DB	0x90,0x80,0x70,0x50,0x00
    0000008D 67 63 53                54 	.DB	0x67,0x63,0x53
                                     55 
    00000090                         56 gbt_frequencies:
    00000090 2C 00 9C 00 06 01 6B    57 	.DW	  44,  156,  262,  363,  457,  547,  631,  710,  786,  854,  923,  986
             01 C9 01 23 02 77 02
             C6 02 12 03 56 03 9B
             03 DA 03
    000000A8 16 04 4E 04 83 04 B5    58 	.DW	1046, 1102, 1155, 1205, 1253, 1297, 1339, 1379, 1417, 1452, 1486, 1517
             04 E5 04 11 05 3B 05
             63 05 89 05 AC 05 CE
             05 ED 05
    000000C0 0A 06 27 06 42 06 5B    59 	.DW	1546, 1575, 1602, 1627, 1650, 1673, 1694, 1714, 1732, 1750, 1767, 1783
             06 72 06 89 06 9E 06
             B2 06 C4 06 D6 06 E7
             06 F7 06
    000000D8 06 07 14 07 21 07 2D    60 	.DW	1798, 1812, 1825, 1837, 1849, 1860, 1871, 1881, 1890, 1899, 1907, 1915
             07 39 07 44 07 4F 07
             59 07 62 07 6B 07 73
             07 7B 07
    000000F0 83 07 8A 07 90 07 97    61 	.DW	1923, 1930, 1936, 1943, 1949, 1954, 1959, 1964, 1969, 1974, 1978, 1982
             07 9D 07 A2 07 A7 07
             AC 07 B1 07 B6 07 BA
             07 BE 07
    00000108 C1 07 C4 07 C8 07 CB    62 	.DW	1985, 1988, 1992, 1995, 1998, 2001, 2004, 2006, 2009, 2011, 2013, 2015
             07 CE 07 D1 07 D4 07
             D6 07 D9 07 DB 07 DD
             07 DF 07
                                     63 
                                     64 ;-------------------------------------------------------------------------------
                                     65 
    00000120                         66 _gbt_get_freq_from_index: ; a = index, bc = returned freq
    00000120 21 90 00         [12]   67 	ld	hl,#gbt_frequencies
    00000123 4F               [ 4]   68 	ld	c,a
    00000124 06 00            [ 8]   69 	ld	b,#0
    00000126 09               [ 8]   70 	add	hl,bc
    00000127 09               [ 8]   71 	add	hl,bc
    00000128 4E               [ 8]   72 	ld	c,(hl)
    00000129 23               [ 8]   73 	inc	hl
    0000012A 46               [ 8]   74 	ld	b,(hl)
    0000012B C9               [16]   75 	ret
                                     76 
                                     77 ;-------------------------------------------------------------------------------
                                     78 ;---------------------------------- Channel 1 ----------------------------------
                                     79 ;-------------------------------------------------------------------------------
                                     80 
    0000012C                         81 gbt_channel_1_handle:: ; de = info
                                     82 
    0000012C FA 00 00         [16]   83 	ld	a,(gbt_channels_enabled)
    0000012F E6 01            [ 8]   84 	and	a,#0x01
    00000131 20 14            [12]   85 	jr	nz,channel1_enabled$
                                     86 
                                     87 	; Channel is disabled. Increment pointer as needed
                                     88 
    00000133 1A               [ 8]   89 	ld	a,(de)
    00000134 13               [ 8]   90 	inc	de
    00000135 CB 7F            [ 8]   91 	bit	7,a
    00000137 20 06            [12]   92 	jr	nz,ch1_more_bytes$
    00000139 CB 77            [ 8]   93 	bit	6,a
    0000013B 28 09            [12]   94 	jr	z,ch1_no_more_bytes_this_channel$
                                     95 
    0000013D 18 06            [12]   96 	jr	ch1_one_more_byte$
                                     97 
    0000013F                         98 ch1_more_bytes$:
                                     99 
    0000013F 1A               [ 8]  100 	ld	a,(de)
    00000140 13               [ 8]  101 	inc	de
    00000141 CB 7F            [ 8]  102 	bit	7,a
    00000143 28 01            [12]  103 	jr	z,ch1_no_more_bytes_this_channel$
                                    104 
    00000145                        105 ch1_one_more_byte$:
                                    106 
    00000145 13               [ 8]  107 	inc	de
                                    108 
    00000146                        109 ch1_no_more_bytes_this_channel$:
                                    110 
    00000146 C9               [16]  111 	ret
                                    112 
    00000147                        113 channel1_enabled$:
                                    114 
                                    115 	; Channel 1 is enabled
                                    116 
    00000147 1A               [ 8]  117 	ld	a,(de)
    00000148 13               [ 8]  118 	inc	de
                                    119 
    00000149 CB 7F            [ 8]  120 	bit	7,a
    0000014B 20 24            [12]  121 	jr	nz,ch1_has_frequency$
                                    122 
                                    123 	; Not frequency
                                    124 
    0000014D CB 77            [ 8]  125 	bit	6,a
    0000014F 20 0E            [12]  126 	jr	nz,ch1_instr_effects$
                                    127 
                                    128 	; Set volume or NOP
                                    129 
    00000151 CB 6F            [ 8]  130 	bit	5,a
    00000153 20 01            [12]  131 	jr	nz,ch1_just_set_volume$
                                    132 
                                    133 	; NOP
                                    134 
    00000155 C9               [16]  135 	ret
                                    136 
    00000156                        137 ch1_just_set_volume$:
                                    138 
                                    139 	; Set volume
                                    140 
    00000156 E6 0F            [ 8]  141 	and	a,#0x0F
    00000158 CB 37            [ 8]  142 	swap	a
    0000015A EA 00 00         [16]  143 	ld	(gbt_vol+0),a
                                    144 
    0000015D 18 4C            [12]  145 	jr	refresh_channel1_regs$
                                    146 
    0000015F                        147 ch1_instr_effects$:
                                    148 
                                    149 	; Set instrument and effect
                                    150 
    0000015F 47               [ 4]  151 	ld	b,a ; save byte
                                    152 
    00000160 E6 30            [ 8]  153 	and	a,#0x30
    00000162 CB 27            [ 8]  154 	sla	a
    00000164 CB 27            [ 8]  155 	sla	a
    00000166 EA 00 00         [16]  156 	ld	(gbt_instr+0),a ; Instrument
                                    157 
    00000169 78               [ 4]  158 	ld	a,b ; restore byte
                                    159 
    0000016A E6 0F            [ 8]  160 	and	a,#0x0F ; a = effect
                                    161 
    0000016C CD 2D 02         [24]  162 	call	gbt_channel_1_set_effect
                                    163 
    0000016F 18 3A            [12]  164 	jr	refresh_channel1_regs$
                                    165 
    00000171                        166 ch1_has_frequency$:
                                    167 
                                    168 	; Has frequency
                                    169 
    00000171 E6 7F            [ 8]  170 	and	a,#0x7F
    00000173 EA 00 00         [16]  171 	ld	(gbt_arpeggio_freq_index+0*3),a
                                    172 	; This destroys hl and a. Returns freq in bc
    00000176 CD 20 01         [24]  173 	call	_gbt_get_freq_from_index
                                    174 
    00000179 79               [ 4]  175 	ld	a,c
    0000017A EA 00 00         [16]  176 	ld	(gbt_freq+0*2+0),a
    0000017D 78               [ 4]  177 	ld	a,b
    0000017E EA 01 00         [16]  178 	ld	(gbt_freq+0*2+1),a ; Get frequency
                                    179 
    00000181 1A               [ 8]  180 	ld	a,(de)
    00000182 13               [ 8]  181 	inc	de
                                    182 
    00000183 CB 7F            [ 8]  183 	bit	7,a
    00000185 20 14            [12]  184 	jr	nz,ch1_freq_instr_and_effect$
                                    185 
                                    186 	; Freq + Instr + Volume
                                    187 
    00000187 47               [ 4]  188 	ld	b,a ; save byte
                                    189 
    00000188 E6 30            [ 8]  190 	and	a,#0x30
    0000018A CB 27            [ 8]  191 	sla	a
    0000018C CB 27            [ 8]  192 	sla	a
    0000018E EA 00 00         [16]  193 	ld	(gbt_instr+0),a ; Instrument
                                    194 
    00000191 78               [ 4]  195 	ld	a,b ; restore byte
                                    196 
    00000192 E6 0F            [ 8]  197 	and	a,#0x0F ; a = volume
                                    198 
    00000194 CB 37            [ 8]  199 	swap	a
    00000196 EA 00 00         [16]  200 	ld	(gbt_vol+0),a
                                    201 
    00000199 18 10            [12]  202 	jr	refresh_channel1_regs$
                                    203 
    0000019B                        204 ch1_freq_instr_and_effect$:
                                    205 
                                    206 	; Freq + Instr + Effect
                                    207 
    0000019B 47               [ 4]  208 	ld	b,a ; save byte
                                    209 
    0000019C E6 30            [ 8]  210 	and	a,#0x30
    0000019E CB 27            [ 8]  211 	sla	a
    000001A0 CB 27            [ 8]  212 	sla	a
    000001A2 EA 00 00         [16]  213 	ld	(gbt_instr+0),a ; Instrument
                                    214 
    000001A5 78               [ 4]  215 	ld	a,b ; restore byte
                                    216 
    000001A6 E6 0F            [ 8]  217 	and	a,#0x0F ; a = effect
                                    218 
    000001A8 CD 2D 02         [24]  219 	call	gbt_channel_1_set_effect
                                    220 
                                    221 	;jr	refresh_channel1_regs$
                                    222 
    000001AB                        223 refresh_channel1_regs$:
                                    224 
                                    225 	; fall through!
                                    226 
                                    227 ; -----------------
                                    228 
    000001AB                        229 channel1_refresh_registers:
                                    230 
    000001AB AF               [ 4]  231 	xor	a,a
    000001AC EA 10 FF         [16]  232 	ld	(#.NR10),a
    000001AF FA 00 00         [16]  233 	ld	a,(gbt_instr+0)
    000001B2 EA 11 FF         [16]  234 	ld	(#.NR11),a
    000001B5 FA 00 00         [16]  235 	ld	a,(gbt_vol+0)
    000001B8 EA 12 FF         [16]  236 	ld	(#.NR12),a
    000001BB FA 00 00         [16]  237 	ld	a,(gbt_freq+0*2+0)
    000001BE EA 13 FF         [16]  238 	ld	(#.NR13),a
    000001C1 FA 01 00         [16]  239 	ld	a,(gbt_freq+0*2+1)
    000001C4 F6 80            [ 8]  240 	or	a,#0x80 ; start
    000001C6 EA 14 FF         [16]  241 	ld	(#.NR14),a
                                    242 
    000001C9 C9               [16]  243 	ret
                                    244 
                                    245 ; ------------------
                                    246 
    000001CA                        247 channel1_update_effects: ; returns 1 in a if it is needed to update sound registers
                                    248 
                                    249 	; Cut note
                                    250 	; --------
                                    251 
    000001CA FA 00 00         [16]  252 	ld	a,(gbt_cut_note_tick+0)
    000001CD 21 00 00         [12]  253 	ld	hl,#gbt_ticks_elapsed
    000001D0 BE               [ 8]  254 	cp	a,(hl)
    000001D1 C2 E1 01         [16]  255 	jp	nz,ch1_dont_cut$
                                    256 
    000001D4 3D               [ 4]  257 	dec	a ; a = 0xFF
    000001D5 EA 00 00         [16]  258 	ld	(gbt_cut_note_tick+0),a ; disable cut note
                                    259 
    000001D8 AF               [ 4]  260 	xor	a,a ; vol = 0
    000001D9 EA 12 FF         [16]  261 	ld	(#.NR12),a
    000001DC 3E 80            [ 8]  262 	ld	a,#0x80 ; start
    000001DE EA 14 FF         [16]  263 	ld	(#.NR14),a
                                    264 
    000001E1                        265 ch1_dont_cut$:
                                    266 
                                    267 	; Arpeggio
                                    268 	; --------
                                    269 
    000001E1 FA 00 00         [16]  270 	ld	a,(gbt_arpeggio_enabled+0)
    000001E4 A7               [ 4]  271 	and	a,a
    000001E5 C8               [20]  272 	ret	z ; a is 0, return 0
                                    273 
                                    274 	; If enabled arpeggio, handle it
                                    275 
    000001E6 FA 00 00         [16]  276 	ld	a,(gbt_arpeggio_tick+0)
    000001E9 A7               [ 4]  277 	and	a,a
    000001EA 20 14            [12]  278 	jr	nz,ch1_not_tick_0$
                                    279 
                                    280 	; Tick 0 - Set original frequency
                                    281 
    000001EC FA 00 00         [16]  282 	ld	a,(gbt_arpeggio_freq_index+0*3+0)
                                    283 
    000001EF CD 20 01         [24]  284 	call	_gbt_get_freq_from_index
                                    285 
    000001F2 79               [ 4]  286 	ld	a,c
    000001F3 EA 00 00         [16]  287 	ld	(gbt_freq+0*2+0),a
    000001F6 78               [ 4]  288 	ld	a,b
    000001F7 EA 01 00         [16]  289 	ld	(gbt_freq+0*2+1),a ; Set frequency
                                    290 
    000001FA 3E 01            [ 8]  291 	ld	a,#1
    000001FC EA 00 00         [16]  292 	ld	(gbt_arpeggio_tick+0),a
                                    293 
    000001FF C9               [16]  294 	ret ; ret 1
                                    295 
    00000200                        296 ch1_not_tick_0$:
                                    297 
    00000200 FE 01            [ 8]  298 	cp	a,#1
    00000202 20 15            [12]  299 	jr	nz,ch1_not_tick_1$
                                    300 
                                    301 	; Tick 1
                                    302 
    00000204 FA 01 00         [16]  303 	ld	a,(gbt_arpeggio_freq_index+0*3+1)
                                    304 
    00000207 CD 20 01         [24]  305 	call	_gbt_get_freq_from_index
                                    306 
    0000020A 79               [ 4]  307 	ld	a,c
    0000020B EA 00 00         [16]  308 	ld	(gbt_freq+0*2+0),a
    0000020E 78               [ 4]  309 	ld	a,b
    0000020F EA 01 00         [16]  310 	ld	(gbt_freq+0*2+1),a ; Set frequency
                                    311 
    00000212 3E 02            [ 8]  312 	ld	a,#2
    00000214 EA 00 00         [16]  313 	ld	(gbt_arpeggio_tick+0),a
                                    314 
    00000217 3D               [ 4]  315 	dec	a
    00000218 C9               [16]  316 	ret ; ret 1
                                    317 
    00000219                        318 ch1_not_tick_1$:
                                    319 
                                    320 	; Tick 2
                                    321 
    00000219 FA 02 00         [16]  322 	ld	a,(gbt_arpeggio_freq_index+0*3+2)
                                    323 
    0000021C CD 20 01         [24]  324 	call	_gbt_get_freq_from_index
                                    325 
    0000021F 79               [ 4]  326 	ld	a,c
    00000220 EA 00 00         [16]  327 	ld	(gbt_freq+0*2+0),a
    00000223 78               [ 4]  328 	ld	a,b
    00000224 EA 01 00         [16]  329 	ld	(gbt_freq+0*2+1),a ; Set frequency
                                    330 
    00000227 AF               [ 4]  331 	xor	a,a
    00000228 EA 00 00         [16]  332 	ld	(gbt_arpeggio_tick+0),a
                                    333 
    0000022B 3C               [ 4]  334 	inc	a
    0000022C C9               [16]  335 	ret ; ret 1
                                    336 
                                    337 ; -----------------
                                    338 
                                    339 ; returns a = 1 if needed to update registers, 0 if not
    0000022D                        340 gbt_channel_1_set_effect: ; a = effect, de = pointer to data.
                                    341 
    0000022D 21 3B 02         [12]  342 	ld	hl,#gbt_ch1_jump_table$
    00000230 4F               [ 4]  343 	ld	c,a
    00000231 06 00            [ 8]  344 	ld	b,#0
    00000233 09               [ 8]  345 	add	hl,bc
    00000234 09               [ 8]  346 	add	hl,bc
                                    347 
    00000235 2A               [ 8]  348 	ld	a,(hl+)
    00000236 66               [ 8]  349 	ld	h,(hl)
    00000237 6F               [ 4]  350 	ld	l,a
                                    351 
    00000238 1A               [ 8]  352 	ld	a,(de) ; load args
    00000239 13               [ 8]  353 	inc	de
                                    354 
    0000023A E9               [ 4]  355 	jp	(hl)
                                    356 
    0000023B                        357 gbt_ch1_jump_table$:
    0000023B 5B 02                  358 	.DW	gbt_ch1_pan$
    0000023D 62 02                  359 	.DW	gbt_ch1_arpeggio$
    0000023F 7D 02                  360 	.DW	gbt_ch1_cut_note$
    00000241 09 06                  361 	.DW	gbt_ch1234_nop
    00000243 09 06                  362 	.DW	gbt_ch1234_nop
    00000245 09 06                  363 	.DW	gbt_ch1234_nop
    00000247 09 06                  364 	.DW	gbt_ch1234_nop
    00000249 09 06                  365 	.DW	gbt_ch1234_nop
    0000024B 0B 06                  366 	.DW	gbt_ch1234_jump_pattern
    0000024D 1C 06                  367 	.DW	gbt_ch1234_jump_position
    0000024F 2E 06                  368 	.DW	gbt_ch1234_speed
    00000251 09 06                  369 	.DW	gbt_ch1234_nop
    00000253 09 06                  370 	.DW	gbt_ch1234_nop
    00000255 09 06                  371 	.DW	gbt_ch1234_nop
    00000257 09 06                  372 	.DW	gbt_ch1234_nop
    00000259 09 06                  373 	.DW	gbt_ch1234_nop
                                    374 
    0000025B                        375 gbt_ch1_pan$:
    0000025B E6 11            [ 8]  376 	and	a,#0x11
    0000025D EA 00 00         [16]  377 	ld	(gbt_pan+0),a
    00000260 AF               [ 4]  378 	xor	a,a
    00000261 C9               [16]  379 	ret ; ret 0 do not update registers, only NR51 at end.
                                    380 
    00000262                        381 gbt_ch1_arpeggio$:
    00000262 47               [ 4]  382 	ld	b,a ; b = params
                                    383 
    00000263 21 00 00         [12]  384 	ld	hl,#gbt_arpeggio_freq_index+0*3
    00000266 4E               [ 8]  385 	ld	c,(hl) ; c = base index
    00000267 23               [ 8]  386 	inc	hl
                                    387 
    00000268 78               [ 4]  388 	ld	a,b
    00000269 CB 37            [ 8]  389 	swap	a
    0000026B E6 0F            [ 8]  390 	and	a,#0x0F
    0000026D 81               [ 4]  391 	add	a,c
                                    392 
    0000026E 22               [ 8]  393 	ld	(hl+),a ; save first increment
                                    394 
    0000026F 78               [ 4]  395 	ld	a,b
    00000270 E6 0F            [ 8]  396 	and	a,#0x0F
    00000272 81               [ 4]  397 	add	a,c
                                    398 
    00000273 77               [ 8]  399 	ld	(hl),a ; save second increment
                                    400 
    00000274 3E 01            [ 8]  401 	ld	a,#1
    00000276 EA 00 00         [16]  402 	ld	(gbt_arpeggio_enabled+0),a
    00000279 EA 00 00         [16]  403 	ld	(gbt_arpeggio_tick+0),a
                                    404 
    0000027C C9               [16]  405 	ret ; ret 1
                                    406 
    0000027D                        407 gbt_ch1_cut_note$:
    0000027D EA 00 00         [16]  408 	ld	(gbt_cut_note_tick+0),a
    00000280 AF               [ 4]  409 	xor	a,a ; ret 0
    00000281 C9               [16]  410 	ret
                                    411 
                                    412 ;-------------------------------------------------------------------------------
                                    413 ;---------------------------------- Channel 2 ----------------------------------
                                    414 ;-------------------------------------------------------------------------------
                                    415 
    00000282                        416 gbt_channel_2_handle:: ; de = info
                                    417 
    00000282 FA 00 00         [16]  418 	ld	a,(gbt_channels_enabled)
    00000285 E6 02            [ 8]  419 	and	a,#0x02
    00000287 20 14            [12]  420 	jr	nz,channel2_enabled$
                                    421 
                                    422 	; Channel is disabled. Increment pointer as needed
                                    423 
    00000289 1A               [ 8]  424 	ld	a,(de)
    0000028A 13               [ 8]  425 	inc	de
    0000028B CB 7F            [ 8]  426 	bit	7,a
    0000028D 20 06            [12]  427 	jr	nz,ch2_more_bytes$
    0000028F CB 77            [ 8]  428 	bit	6,a
    00000291 28 09            [12]  429 	jr	z,ch2_no_more_bytes_this_channel$
                                    430 
    00000293 18 06            [12]  431 	jr	ch2_one_more_byte$
                                    432 
    00000295                        433 ch2_more_bytes$:
                                    434 
    00000295 1A               [ 8]  435 	ld	a,(de)
    00000296 13               [ 8]  436 	inc	de
    00000297 CB 7F            [ 8]  437 	bit	7,a
    00000299 28 01            [12]  438 	jr	z,ch2_no_more_bytes_this_channel$
                                    439 
    0000029B                        440 ch2_one_more_byte$:
                                    441 
    0000029B 13               [ 8]  442 	inc	de
                                    443 
    0000029C                        444 ch2_no_more_bytes_this_channel$:
                                    445 
    0000029C C9               [16]  446 	ret
                                    447 
    0000029D                        448 channel2_enabled$:
                                    449 
                                    450 	; Channel 2 is enabled
                                    451 
    0000029D 1A               [ 8]  452 	ld	a,(de)
    0000029E 13               [ 8]  453 	inc	de
                                    454 
    0000029F CB 7F            [ 8]  455 	bit	7,a
    000002A1 20 24            [12]  456 	jr	nz,ch2_has_frequency$
                                    457 
                                    458 	; Not frequency
                                    459 
    000002A3 CB 77            [ 8]  460 	bit	6,a
    000002A5 20 0E            [12]  461 	jr	nz,ch2_instr_effects$
                                    462 
                                    463 	; Set volume or NOP
                                    464 
    000002A7 CB 6F            [ 8]  465 	bit	5,a
    000002A9 20 01            [12]  466 	jr	nz,ch2_just_set_volume$
                                    467 
                                    468 	; NOP
                                    469 
    000002AB C9               [16]  470 	ret
                                    471 
    000002AC                        472 ch2_just_set_volume$:
                                    473 
                                    474 	; Set volume
                                    475 
    000002AC E6 0F            [ 8]  476 	and	a,#0x0F
    000002AE CB 37            [ 8]  477 	swap	a
    000002B0 EA 01 00         [16]  478 	ld	(gbt_vol+1),a
                                    479 
    000002B3 18 4C            [12]  480 	jr	refresh_channel2_regs$
                                    481 
    000002B5                        482 ch2_instr_effects$:
                                    483 
                                    484 	; Set instrument and effect
                                    485 
    000002B5 47               [ 4]  486 	ld	b,a ; save byte
                                    487 
    000002B6 E6 30            [ 8]  488 	and	a,#0x30
    000002B8 CB 27            [ 8]  489 	sla	a
    000002BA CB 27            [ 8]  490 	sla	a
    000002BC EA 01 00         [16]  491 	ld	(gbt_instr+1),a ; Instrument
                                    492 
    000002BF 78               [ 4]  493 	ld	a,b ; restore byte
                                    494 
    000002C0 E6 0F            [ 8]  495 	and	a,#0x0F ; a = effect
                                    496 
    000002C2 CD 7F 03         [24]  497 	call	gbt_channel_2_set_effect
                                    498 
    000002C5 18 3A            [12]  499 	jr	refresh_channel2_regs$
                                    500 
    000002C7                        501 ch2_has_frequency$:
                                    502 
                                    503 	; Has frequency
                                    504 
    000002C7 E6 7F            [ 8]  505 	and	a,#0x7F
    000002C9 EA 03 00         [16]  506 	ld	(gbt_arpeggio_freq_index+1*3),a
                                    507 	; This destroys hl and a. Returns freq in bc
    000002CC CD 20 01         [24]  508 	call	_gbt_get_freq_from_index
                                    509 
    000002CF 79               [ 4]  510 	ld	a,c
    000002D0 EA 02 00         [16]  511 	ld	(gbt_freq+1*2+0),a
    000002D3 78               [ 4]  512 	ld	a,b
    000002D4 EA 03 00         [16]  513 	ld	(gbt_freq+1*2+1),a ; Get frequency
                                    514 
    000002D7 1A               [ 8]  515 	ld	a,(de)
    000002D8 13               [ 8]  516 	inc	de
                                    517 
    000002D9 CB 7F            [ 8]  518 	bit	7,a
    000002DB 20 14            [12]  519 	jr	nz,ch2_freq_instr_and_effect$
                                    520 
                                    521 	; Freq + Instr + Volume
                                    522 
    000002DD 47               [ 4]  523 	ld	b,a ; save byte
                                    524 
    000002DE E6 30            [ 8]  525 	and	a,#0x30
    000002E0 CB 27            [ 8]  526 	sla	a
    000002E2 CB 27            [ 8]  527 	sla	a
    000002E4 EA 01 00         [16]  528 	ld	(gbt_instr+1),a ; Instrument
                                    529 
    000002E7 78               [ 4]  530 	ld	a,b ; restore byte
                                    531 
    000002E8 E6 0F            [ 8]  532 	and	a,#0x0F ; a = volume
                                    533 
    000002EA CB 37            [ 8]  534 	swap	a
    000002EC EA 01 00         [16]  535 	ld	(gbt_vol+1),a
                                    536 
    000002EF 18 10            [12]  537 	jr	refresh_channel2_regs$
                                    538 
    000002F1                        539 ch2_freq_instr_and_effect$:
                                    540 
                                    541 	; Freq + Instr + Effect
                                    542 
    000002F1 47               [ 4]  543 	ld	b,a ; save byte
                                    544 
    000002F2 E6 30            [ 8]  545 	and	a,#0x30
    000002F4 CB 27            [ 8]  546 	sla	a
    000002F6 CB 27            [ 8]  547 	sla	a
    000002F8 EA 01 00         [16]  548 	ld	(gbt_instr+1),a ; Instrument
                                    549 
    000002FB 78               [ 4]  550 	ld	a,b ; restore byte
                                    551 
    000002FC E6 0F            [ 8]  552 	and	a,#0x0F ; a = effect
                                    553 
    000002FE CD 7F 03         [24]  554 	call	gbt_channel_2_set_effect
                                    555 
                                    556 	;jr	.refresh_channel2_regs
                                    557 
    00000301                        558 refresh_channel2_regs$:
                                    559 
                                    560 	; fall through!
                                    561 
                                    562 ; -----------------
                                    563 
    00000301                        564 channel2_refresh_registers:
                                    565 
    00000301 FA 01 00         [16]  566 	ld	a,(gbt_instr+1)
    00000304 EA 16 FF         [16]  567 	ld	(#.NR21),a
    00000307 FA 01 00         [16]  568 	ld	a,(gbt_vol+1)
    0000030A EA 17 FF         [16]  569 	ld	(#.NR22),a
    0000030D FA 02 00         [16]  570 	ld	a,(gbt_freq+1*2+0)
    00000310 EA 18 FF         [16]  571 	ld	(#.NR23),a
    00000313 FA 03 00         [16]  572 	ld	a,(gbt_freq+1*2+1)
    00000316 F6 80            [ 8]  573 	or	a,#0x80 ; start
    00000318 EA 19 FF         [16]  574 	ld	(#.NR24),a
                                    575 
    0000031B C9               [16]  576 	ret
                                    577 
                                    578 ; ------------------
                                    579 
    0000031C                        580 channel2_update_effects: ; returns 1 in a if it is needed to update sound regs
                                    581 
                                    582 	; Cut note
                                    583 	; --------
                                    584 
    0000031C FA 01 00         [16]  585 	ld	a,(gbt_cut_note_tick+1)
    0000031F 21 00 00         [12]  586 	ld	hl,#gbt_ticks_elapsed
    00000322 BE               [ 8]  587 	cp	a,(hl)
    00000323 C2 33 03         [16]  588 	jp	nz,ch2_dont_cut$
                                    589 
    00000326 3D               [ 4]  590 	dec	a ; a = 0xFF
    00000327 EA 01 00         [16]  591 	ld	(gbt_cut_note_tick+1),a ; disable cut note
                                    592 
    0000032A AF               [ 4]  593 	xor	a,a ; vol = 0
    0000032B EA 17 FF         [16]  594 	ld	(#.NR22),a
    0000032E 3E 80            [ 8]  595 	ld	a,#0x80 ; start
    00000330 EA 19 FF         [16]  596 	ld	(#.NR24),a
                                    597 
    00000333                        598 ch2_dont_cut$:
                                    599 
                                    600 	; Arpeggio
                                    601 	; --------
                                    602 
    00000333 FA 01 00         [16]  603 	ld	a,(gbt_arpeggio_enabled+1)
    00000336 A7               [ 4]  604 	and	a,a
    00000337 C8               [20]  605 	ret	z ; a is 0, return 0
                                    606 
                                    607 	; If enabled arpeggio, handle it
                                    608 
    00000338 FA 01 00         [16]  609 	ld	a,(gbt_arpeggio_tick+1)
    0000033B A7               [ 4]  610 	and	a,a
    0000033C 20 14            [12]  611 	jr	nz,ch2_not_tick_0$
                                    612 
                                    613 	; Tick 0 - Set original frequency
                                    614 
    0000033E FA 03 00         [16]  615 	ld	a,(gbt_arpeggio_freq_index+1*3+0)
                                    616 
    00000341 CD 20 01         [24]  617 	call	_gbt_get_freq_from_index
                                    618 
    00000344 79               [ 4]  619 	ld	a,c
    00000345 EA 02 00         [16]  620 	ld	(gbt_freq+1*2+0),a
    00000348 78               [ 4]  621 	ld	a,b
    00000349 EA 03 00         [16]  622 	ld	(gbt_freq+1*2+1),a ; Set frequency
                                    623 
    0000034C 3E 01            [ 8]  624 	ld	a,#1
    0000034E EA 01 00         [16]  625 	ld	(gbt_arpeggio_tick+1),a
                                    626 
    00000351 C9               [16]  627 	ret ; ret 1
                                    628 
    00000352                        629 ch2_not_tick_0$:
                                    630 
    00000352 FE 01            [ 8]  631 	cp	a,#1
    00000354 20 15            [12]  632 	jr	nz,ch2_not_tick_1$
                                    633 
                                    634 	; Tick 1
                                    635 
    00000356 FA 04 00         [16]  636 	ld	a,(gbt_arpeggio_freq_index+1*3+1)
                                    637 
    00000359 CD 20 01         [24]  638 	call	_gbt_get_freq_from_index
                                    639 
    0000035C 79               [ 4]  640 	ld	a,c
    0000035D EA 02 00         [16]  641 	ld	(gbt_freq+1*2+0),a
    00000360 78               [ 4]  642 	ld	a,b
    00000361 EA 03 00         [16]  643 	ld	(gbt_freq+1*2+1),a ; Set frequency
                                    644 
    00000364 3E 02            [ 8]  645 	ld	a,#2
    00000366 EA 01 00         [16]  646 	ld	(gbt_arpeggio_tick+1),a
                                    647 
    00000369 3D               [ 4]  648 	dec	a
    0000036A C9               [16]  649 	ret ; ret 1
                                    650 
    0000036B                        651 ch2_not_tick_1$:
                                    652 
                                    653 	; Tick 2
                                    654 
    0000036B FA 05 00         [16]  655 	ld	a,(gbt_arpeggio_freq_index+1*3+2)
                                    656 
    0000036E CD 20 01         [24]  657 	call	_gbt_get_freq_from_index
                                    658 
    00000371 79               [ 4]  659 	ld	a,c
    00000372 EA 02 00         [16]  660 	ld	(gbt_freq+1*2+0),a
    00000375 78               [ 4]  661 	ld	a,b
    00000376 EA 03 00         [16]  662 	ld	(gbt_freq+1*2+1),a ; Set frequency
                                    663 
    00000379 AF               [ 4]  664 	xor	a,a
    0000037A EA 01 00         [16]  665 	ld	(gbt_arpeggio_tick+1),a
                                    666 
    0000037D 3C               [ 4]  667 	inc	a
    0000037E C9               [16]  668 	ret ; ret 1
                                    669 
                                    670 ; -----------------
                                    671 
                                    672 ; returns a = 1 if needed to update registers, 0 if not
    0000037F                        673 gbt_channel_2_set_effect: ; a = effect, de = pointer to data
                                    674 
    0000037F 21 8D 03         [12]  675 	ld	hl,#gbt_ch2_jump_table$
    00000382 4F               [ 4]  676 	ld	c,a
    00000383 06 00            [ 8]  677 	ld	b,#0
    00000385 09               [ 8]  678 	add	hl,bc
    00000386 09               [ 8]  679 	add	hl,bc
                                    680 
    00000387 2A               [ 8]  681 	ld	a,(hl+)
    00000388 66               [ 8]  682 	ld	h,(hl)
    00000389 6F               [ 4]  683 	ld	l,a
                                    684 
    0000038A 1A               [ 8]  685 	ld	a,(de) ; load args
    0000038B 13               [ 8]  686 	inc	de
                                    687 
    0000038C E9               [ 4]  688 	jp	(hl)
                                    689 
    0000038D                        690 gbt_ch2_jump_table$:
    0000038D AD 03                  691 	.DW	gbt_ch2_pan$
    0000038F B4 03                  692 	.DW	gbt_ch2_arpeggio$
    00000391 CF 03                  693 	.DW	gbt_ch2_cut_note$
    00000393 09 06                  694 	.DW	gbt_ch1234_nop
    00000395 09 06                  695 	.DW	gbt_ch1234_nop
    00000397 09 06                  696 	.DW	gbt_ch1234_nop
    00000399 09 06                  697 	.DW	gbt_ch1234_nop
    0000039B 09 06                  698 	.DW	gbt_ch1234_nop
    0000039D 0B 06                  699 	.DW	gbt_ch1234_jump_pattern
    0000039F 1C 06                  700 	.DW	gbt_ch1234_jump_position
    000003A1 2E 06                  701 	.DW	gbt_ch1234_speed
    000003A3 09 06                  702 	.DW	gbt_ch1234_nop
    000003A5 09 06                  703 	.DW	gbt_ch1234_nop
    000003A7 09 06                  704 	.DW	gbt_ch1234_nop
    000003A9 09 06                  705 	.DW	gbt_ch1234_nop
    000003AB 09 06                  706 	.DW	gbt_ch1234_nop
                                    707 
    000003AD                        708 gbt_ch2_pan$:
    000003AD E6 22            [ 8]  709 	and	a,#0x22
    000003AF EA 01 00         [16]  710 	ld	(gbt_pan+1),a
    000003B2 AF               [ 4]  711 	xor	a,a ; ret 0
    000003B3 C9               [16]  712 	ret ; Should not update registers, only NR51 at end.
                                    713 
    000003B4                        714 gbt_ch2_arpeggio$:
    000003B4 47               [ 4]  715 	ld	b,a ; b = params
                                    716 
    000003B5 21 03 00         [12]  717 	ld	hl,#gbt_arpeggio_freq_index+1*3
    000003B8 4E               [ 8]  718 	ld	c,(hl) ; c = base index
    000003B9 23               [ 8]  719 	inc	hl
                                    720 
    000003BA 78               [ 4]  721 	ld	a,b
    000003BB CB 37            [ 8]  722 	swap	a
    000003BD E6 0F            [ 8]  723 	and	a,#0x0F
    000003BF 81               [ 4]  724 	add	a,c
                                    725 
    000003C0 22               [ 8]  726 	ld	(hl+),a ; save first increment
                                    727 
    000003C1 78               [ 4]  728 	ld	a,b
    000003C2 E6 0F            [ 8]  729 	and	a,#0x0F
    000003C4 81               [ 4]  730 	add	a,c
                                    731 
    000003C5 77               [ 8]  732 	ld	(hl),a ; save second increment
                                    733 
    000003C6 3E 01            [ 8]  734 	ld	a,#1
    000003C8 EA 01 00         [16]  735 	ld	(gbt_arpeggio_enabled+1),a
    000003CB EA 01 00         [16]  736 	ld	(gbt_arpeggio_tick+1),a
                                    737 
    000003CE C9               [16]  738 	ret ; ret 1
                                    739 
    000003CF                        740 gbt_ch2_cut_note$:
    000003CF EA 01 00         [16]  741 	ld	(gbt_cut_note_tick+1),a
    000003D2 AF               [ 4]  742 	xor	a,a ; ret 0
    000003D3 C9               [16]  743 	ret
                                    744 
                                    745 ;-------------------------------------------------------------------------------
                                    746 ;---------------------------------- Channel 3 ----------------------------------
                                    747 ;-------------------------------------------------------------------------------
                                    748 
    000003D4                        749 gbt_channel_3_handle:: ; de = info
                                    750 
    000003D4 FA 00 00         [16]  751 	ld	a,(gbt_channels_enabled)
    000003D7 E6 04            [ 8]  752 	and	a,#0x04
    000003D9 20 14            [12]  753 	jr	nz,channel3_enabled$
                                    754 
                                    755 	; Channel is disabled. Increment pointer as needed
                                    756 
    000003DB 1A               [ 8]  757 	ld	a,(de)
    000003DC 13               [ 8]  758 	inc	de
    000003DD CB 7F            [ 8]  759 	bit	7,a
    000003DF 20 06            [12]  760 	jr	nz,ch3_more_bytes$
    000003E1 CB 77            [ 8]  761 	bit	6,a
    000003E3 28 09            [12]  762 	jr	z,ch3_no_more_bytes_this_channel$
                                    763 
    000003E5 18 06            [12]  764 	jr	ch3_one_more_byte$
                                    765 
    000003E7                        766 ch3_more_bytes$:
                                    767 
    000003E7 1A               [ 8]  768 	ld	a,(de)
    000003E8 13               [ 8]  769 	inc	de
    000003E9 CB 7F            [ 8]  770 	bit	7,a
    000003EB 28 01            [12]  771 	jr	z,ch3_no_more_bytes_this_channel$
                                    772 
    000003ED                        773 ch3_one_more_byte$:
                                    774 
    000003ED 13               [ 8]  775 	inc	de
                                    776 
    000003EE                        777 ch3_no_more_bytes_this_channel$:
                                    778 
    000003EE C9               [16]  779 	ret
                                    780 
    000003EF                        781 channel3_enabled$:
                                    782 
                                    783 	; Channel 3 is enabled
                                    784 
    000003EF 1A               [ 8]  785 	ld	a,(de)
    000003F0 13               [ 8]  786 	inc	de
                                    787 
    000003F1 CB 7F            [ 8]  788 	bit	7,a
    000003F3 20 19            [12]  789 	jr	nz,ch3_has_frequency$
                                    790 
                                    791 	; Not frequency
                                    792 
    000003F5 CB 77            [ 8]  793 	bit	6,a
    000003F7 20 0C            [12]  794 	jr	nz,ch3_effects$
                                    795 
                                    796 	; Set volume or NOP
                                    797 
    000003F9 CB 6F            [ 8]  798 	bit	5,a
    000003FB 20 01            [12]  799 	jr	nz,ch3_just_set_volume$
                                    800 
                                    801 	; NOP
                                    802 
    000003FD C9               [16]  803 	ret
                                    804 
    000003FE                        805 ch3_just_set_volume$:
                                    806 
                                    807 	; Set volume
                                    808 
    000003FE CB 37            [ 8]  809 	swap	a
    00000400 EA 02 00         [16]  810 	ld	(gbt_vol+2),a
                                    811 
    00000403 18 3D            [12]  812 	jr	refresh_channel3_regs$
                                    813 
    00000405                        814 ch3_effects$:
                                    815 
                                    816 	; Set effect
                                    817 
    00000405 E6 0F            [ 8]  818 	and	a,#0x0F ; a = effect
                                    819 
    00000407 CD EE 04         [24]  820 	call	gbt_channel_3_set_effect
    0000040A A7               [ 4]  821 	and	a,a
    0000040B C8               [20]  822 	ret	z ; if 0, don't refresh registers
                                    823 
    0000040C 18 34            [12]  824 	jr	refresh_channel3_regs$
                                    825 
    0000040E                        826 ch3_has_frequency$:
                                    827 
                                    828 	; Has frequency
                                    829 
    0000040E E6 7F            [ 8]  830 	and	a,#0x7F
    00000410 EA 06 00         [16]  831 	ld	(gbt_arpeggio_freq_index+2*3),a
                                    832 	; This destroys hl and a. Returns freq in bc
    00000413 CD 20 01         [24]  833 	call	_gbt_get_freq_from_index
                                    834 
    00000416 79               [ 4]  835 	ld	a,c
    00000417 EA 04 00         [16]  836 	ld	(gbt_freq+2*2+0),a
    0000041A 78               [ 4]  837 	ld	a,b
    0000041B EA 05 00         [16]  838 	ld	(gbt_freq+2*2+1),a ; Get frequency
                                    839 
    0000041E 1A               [ 8]  840 	ld	a,(de)
    0000041F 13               [ 8]  841 	inc	de
                                    842 
    00000420 CB 7F            [ 8]  843 	bit	7,a
    00000422 20 10            [12]  844 	jr	nz,ch3_freq_instr_and_effect$
                                    845 
                                    846 	; Freq + Instr + Volume
                                    847 
    00000424 47               [ 4]  848 	ld	b,a ; save byte
                                    849 
    00000425 E6 0F            [ 8]  850 	and	a,#0x0F
    00000427 EA 02 00         [16]  851 	ld	(gbt_instr+2),a ; Instrument
                                    852 
    0000042A 78               [ 4]  853 	ld	a,b ; restore byte
                                    854 
    0000042B E6 30            [ 8]  855 	and	a,#0x30 ; a = volume
    0000042D CB 27            [ 8]  856 	sla	a
    0000042F EA 02 00         [16]  857 	ld	(gbt_vol+2),a
                                    858 
    00000432 18 0E            [12]  859 	jr	refresh_channel3_regs$
                                    860 
    00000434                        861 ch3_freq_instr_and_effect$:
                                    862 
                                    863 	; Freq + Instr + Effect
                                    864 
    00000434 47               [ 4]  865 	ld	b,a ; save byte
                                    866 
    00000435 E6 0F            [ 8]  867 	and	a,#0x0F
    00000437 EA 02 00         [16]  868 	ld	(gbt_instr+2),a ; Instrument
                                    869 
    0000043A 78               [ 4]  870 	ld	a,b ; restore byte
                                    871 
    0000043B E6 70            [ 8]  872 	and	a,#0x70
    0000043D CB 37            [ 8]  873 	swap	a	; a = effect (only 0-7 allowed here)
                                    874 
    0000043F CD EE 04         [24]  875 	call	gbt_channel_3_set_effect
                                    876 
                                    877 	;jr	.refresh_channel3_regs
                                    878 
    00000442                        879 refresh_channel3_regs$:
                                    880 
                                    881 	; fall through!
                                    882 
                                    883 ; -----------------
                                    884 
    00000442                        885 channel3_refresh_registers:
                                    886 
    00000442 AF               [ 4]  887 	xor	a,a
    00000443 EA 1A FF         [16]  888 	ld	(#.NR30),a ; disable
                                    889 
    00000446 FA 00 00         [16]  890 	ld	a,(gbt_channel3_loaded_instrument)
    00000449 47               [ 4]  891 	ld	b,a
    0000044A FA 02 00         [16]  892 	ld	a,(gbt_instr+2)
    0000044D B8               [ 4]  893 	cp	a,b
    0000044E C4 6F 04         [24]  894 	call	nz,gbt_channel3_load_instrument ; a = instrument
                                    895 
    00000451 3E 80            [ 8]  896 	ld	a,#0x80
    00000453 EA 1A FF         [16]  897 	ld	(#.NR30),a ; enable
                                    898 
    00000456 AF               [ 4]  899 	xor	a,a
    00000457 EA 1B FF         [16]  900 	ld	(#.NR31),a
    0000045A FA 02 00         [16]  901 	ld	a,(gbt_vol+2)
    0000045D EA 1C FF         [16]  902 	ld	(#.NR32),a
    00000460 FA 04 00         [16]  903 	ld	a,(gbt_freq+2*2+0)
    00000463 EA 1D FF         [16]  904 	ld	(#.NR33),a
    00000466 FA 05 00         [16]  905 	ld	a,(gbt_freq+2*2+1)
    00000469 F6 80            [ 8]  906 	or	a,#0x80 ; start
    0000046B EA 1E FF         [16]  907 	ld	(#.NR34),a
                                    908 
    0000046E C9               [16]  909 	ret
                                    910 
                                    911 ; ------------------
                                    912 
    0000046F                        913 gbt_channel3_load_instrument:
                                    914 
    0000046F EA 00 00         [16]  915 	ld	(gbt_channel3_loaded_instrument),a
                                    916 
    00000472 CB 37            [ 8]  917 	swap	a ; a = a * 16
    00000474 4F               [ 4]  918 	ld	c,a
    00000475 06 00            [ 8]  919 	ld	b,#0
    00000477 21 00 00         [12]  920 	ld	hl,#gbt_wave
    0000047A 09               [ 8]  921 	add	hl,bc
                                    922 
    0000047B 0E 30            [ 8]  923 	ld	c,#0x30
    0000047D 06 10            [ 8]  924 	ld	b,#16
    0000047F                        925 ch3_loop$:
    0000047F 2A               [ 8]  926 	ld	a,(hl+)
    00000480 E2               [ 8]  927 	ldh	(c),a
    00000481 0C               [ 4]  928 	inc	c
    00000482 05               [ 4]  929 	dec	b
    00000483 20 FA            [12]  930 	jr	nz,ch3_loop$
                                    931 
    00000485 C9               [16]  932 	ret
                                    933 
                                    934 ; ------------------
                                    935 
    00000486                        936 channel3_update_effects: ; returns 1 in a if it is needed to update sound regs
                                    937 
                                    938 	; Cut note
                                    939 	; --------
                                    940 
    00000486 FA 02 00         [16]  941 	ld	a,(gbt_cut_note_tick+2)
    00000489 21 00 00         [12]  942 	ld	hl,#gbt_ticks_elapsed
    0000048C BE               [ 8]  943 	cp	a,(hl)
    0000048D C2 A2 04         [16]  944 	jp	nz,ch3_dont_cut$
                                    945 
    00000490 3D               [ 4]  946 	dec	a ; a = 0xFF
    00000491 EA 02 00         [16]  947 	ld	(gbt_cut_note_tick+2),a ; disable cut note
                                    948 
    00000494 3E 80            [ 8]  949 	ld	a,#0x80
    00000496 EA 1A FF         [16]  950 	ld	(#.NR30),a ; enable
                                    951 
    00000499 AF               [ 4]  952 	xor	a,a ; vol = 0
    0000049A EA 1C FF         [16]  953 	ld	(#.NR32),a
    0000049D 3E 80            [ 8]  954 	ld	a,#0x80 ; start
    0000049F EA 1E FF         [16]  955 	ld	(#.NR34),a
                                    956 
    000004A2                        957 ch3_dont_cut$:
                                    958 
                                    959 	; Arpeggio
                                    960 	; --------
                                    961 
    000004A2 FA 02 00         [16]  962 	ld	a,(gbt_arpeggio_enabled+2)
    000004A5 A7               [ 4]  963 	and	a,a
    000004A6 C8               [20]  964 	ret	z ; a is 0, return 0
                                    965 
                                    966 	; If enabled arpeggio, handle it
                                    967 
    000004A7 FA 02 00         [16]  968 	ld	a,(gbt_arpeggio_tick+2)
    000004AA A7               [ 4]  969 	and	a,a
    000004AB 20 14            [12]  970 	jr	nz,ch3_not_tick_0$
                                    971 
                                    972 	; Tick 0 - Set original frequency
                                    973 
    000004AD FA 06 00         [16]  974 	ld	a,(gbt_arpeggio_freq_index+2*3+0)
                                    975 
    000004B0 CD 20 01         [24]  976 	call	_gbt_get_freq_from_index
                                    977 
    000004B3 79               [ 4]  978 	ld	a,c
    000004B4 EA 04 00         [16]  979 	ld	(gbt_freq+2*2+0),a
    000004B7 78               [ 4]  980 	ld	a,b
    000004B8 EA 05 00         [16]  981 	ld	(gbt_freq+2*2+1),a ; Set frequency
                                    982 
    000004BB 3E 01            [ 8]  983 	ld	a,#1
    000004BD EA 02 00         [16]  984 	ld	(gbt_arpeggio_tick+2),a
                                    985 
    000004C0 C9               [16]  986 	ret ; ret 1
                                    987 
    000004C1                        988 ch3_not_tick_0$:
                                    989 
    000004C1 FE 01            [ 8]  990 	cp	a,#1
    000004C3 20 15            [12]  991 	jr	nz,ch3_not_tick_1$
                                    992 
                                    993 	; Tick 1
                                    994 
    000004C5 FA 07 00         [16]  995 	ld	a,(gbt_arpeggio_freq_index+2*3+1)
                                    996 
    000004C8 CD 20 01         [24]  997 	call	_gbt_get_freq_from_index
                                    998 
    000004CB 79               [ 4]  999 	ld	a,c
    000004CC EA 04 00         [16] 1000 	ld	(gbt_freq+2*2+0),a
    000004CF 78               [ 4] 1001 	ld	a,b
    000004D0 EA 05 00         [16] 1002 	ld	(gbt_freq+2*2+1),a ; Set frequency
                                   1003 
    000004D3 3E 02            [ 8] 1004 	ld	a,#2
    000004D5 EA 02 00         [16] 1005 	ld	(gbt_arpeggio_tick+2),a
                                   1006 
    000004D8 3D               [ 4] 1007 	dec	a
    000004D9 C9               [16] 1008 	ret ; ret 1
                                   1009 
    000004DA                       1010 ch3_not_tick_1$:
                                   1011 
                                   1012 	; Tick 2
                                   1013 
    000004DA FA 08 00         [16] 1014 	ld	a,(gbt_arpeggio_freq_index+2*3+2)
                                   1015 
    000004DD CD 20 01         [24] 1016 	call	_gbt_get_freq_from_index
                                   1017 
    000004E0 79               [ 4] 1018 	ld	a,c
    000004E1 EA 04 00         [16] 1019 	ld	(gbt_freq+2*2+0),a
    000004E4 78               [ 4] 1020 	ld	a,b
    000004E5 EA 05 00         [16] 1021 	ld	(gbt_freq+2*2+1),a ; Set frequency
                                   1022 
    000004E8 AF               [ 4] 1023 	xor	a,a
    000004E9 EA 02 00         [16] 1024 	ld	(gbt_arpeggio_tick+2),a
                                   1025 
    000004EC 3C               [ 4] 1026 	inc	a
    000004ED C9               [16] 1027 	ret ; ret 1
                                   1028 
                                   1029 ; -----------------
                                   1030 
                                   1031 ; returns a = 1 if needed to update registers, 0 if not
    000004EE                       1032 gbt_channel_3_set_effect: ; a = effect, de = pointer to data
                                   1033 
    000004EE 21 FC 04         [12] 1034 	ld	hl,#gbt_ch3_jump_table$
    000004F1 4F               [ 4] 1035 	ld	c,a
    000004F2 06 00            [ 8] 1036 	ld	b,#0
    000004F4 09               [ 8] 1037 	add	hl,bc
    000004F5 09               [ 8] 1038 	add	hl,bc
                                   1039 
    000004F6 2A               [ 8] 1040 	ld	a,(hl+)
    000004F7 66               [ 8] 1041 	ld	h,(hl)
    000004F8 6F               [ 4] 1042 	ld	l,a
                                   1043 
    000004F9 1A               [ 8] 1044 	ld	a,(de) ; load args
    000004FA 13               [ 8] 1045 	inc	de
                                   1046 
    000004FB E9               [ 4] 1047 	jp	(hl)
                                   1048 
    000004FC                       1049 gbt_ch3_jump_table$:
    000004FC 1C 05                 1050 	.DW	gbt_ch3_pan$
    000004FE 23 05                 1051 	.DW	gbt_ch3_arpeggio$
    00000500 3E 05                 1052 	.DW	gbt_ch3_cut_note$
    00000502 09 06                 1053 	.DW	gbt_ch1234_nop
    00000504 09 06                 1054 	.DW	gbt_ch1234_nop
    00000506 09 06                 1055 	.DW	gbt_ch1234_nop
    00000508 09 06                 1056 	.DW	gbt_ch1234_nop
    0000050A 09 06                 1057 	.DW	gbt_ch1234_nop
    0000050C 0B 06                 1058 	.DW	gbt_ch1234_jump_pattern
    0000050E 1C 06                 1059 	.DW	gbt_ch1234_jump_position
    00000510 2E 06                 1060 	.DW	gbt_ch1234_speed
    00000512 09 06                 1061 	.DW	gbt_ch1234_nop
    00000514 09 06                 1062 	.DW	gbt_ch1234_nop
    00000516 09 06                 1063 	.DW	gbt_ch1234_nop
    00000518 09 06                 1064 	.DW	gbt_ch1234_nop
    0000051A 09 06                 1065 	.DW	gbt_ch1234_nop
                                   1066 
    0000051C                       1067 gbt_ch3_pan$:
    0000051C E6 44            [ 8] 1068 	and	a,#0x44
    0000051E EA 02 00         [16] 1069 	ld	(gbt_pan+2),a
    00000521 AF               [ 4] 1070 	xor	a,a ; ret 0
    00000522 C9               [16] 1071 	ret ; do not update registers, only NR51 at end.
                                   1072 
    00000523                       1073 gbt_ch3_arpeggio$:
    00000523 47               [ 4] 1074 	ld	b,a ; b = params
                                   1075 
    00000524 21 06 00         [12] 1076 	ld	hl,#gbt_arpeggio_freq_index+2*3
    00000527 4E               [ 8] 1077 	ld	c,(hl) ; c = base index
    00000528 23               [ 8] 1078 	inc	hl
                                   1079 
    00000529 78               [ 4] 1080 	ld	a,b
    0000052A CB 37            [ 8] 1081 	swap	a
    0000052C E6 0F            [ 8] 1082 	and	a,#0x0F
    0000052E 81               [ 4] 1083 	add	a,c
                                   1084 
    0000052F 22               [ 8] 1085 	ld	(hl+),a ; save first increment
                                   1086 
    00000530 78               [ 4] 1087 	ld	a,b
    00000531 E6 0F            [ 8] 1088 	and	a,#0x0F
    00000533 81               [ 4] 1089 	add	a,c
                                   1090 
    00000534 77               [ 8] 1091 	ld	(hl),a ; save second increment
                                   1092 
    00000535 3E 01            [ 8] 1093 	ld	a,#1
    00000537 EA 02 00         [16] 1094 	ld	(gbt_arpeggio_enabled+2),a
    0000053A EA 02 00         [16] 1095 	ld	(gbt_arpeggio_tick+2),a
                                   1096 
    0000053D C9               [16] 1097 	ret ; ret 1
                                   1098 
    0000053E                       1099 gbt_ch3_cut_note$:
    0000053E EA 02 00         [16] 1100 	ld	(gbt_cut_note_tick+2),a
    00000541 AF               [ 4] 1101 	xor	a,a ; ret 0
    00000542 C9               [16] 1102 	ret
                                   1103 
                                   1104 ;-------------------------------------------------------------------------------
                                   1105 ;---------------------------------- Channel 4 ----------------------------------
                                   1106 ;-------------------------------------------------------------------------------
                                   1107 
    00000543                       1108 gbt_channel_4_handle:: ; de = info
                                   1109 
    00000543 FA 00 00         [16] 1110 	ld	a,(gbt_channels_enabled)
    00000546 E6 08            [ 8] 1111 	and	a,#0x08
    00000548 20 14            [12] 1112 	jr	nz,channel4_enabled$
                                   1113 
                                   1114 	; Channel is disabled. Increment pointer as needed
                                   1115 
    0000054A 1A               [ 8] 1116 	ld	a,(de)
    0000054B 13               [ 8] 1117 	inc	de
    0000054C CB 7F            [ 8] 1118 	bit	7,a
    0000054E 20 06            [12] 1119 	jr	nz,ch4_more_bytes$
    00000550 CB 77            [ 8] 1120 	bit	6,a
    00000552 28 09            [12] 1121 	jr	z,ch4_no_more_bytes_this_channel$
                                   1122 
    00000554 18 06            [12] 1123 	jr	ch4_one_more_byte$
                                   1124 
    00000556                       1125 ch4_more_bytes$:
                                   1126 
    00000556 1A               [ 8] 1127 	ld	a,(de)
    00000557 13               [ 8] 1128 	inc	de
    00000558 CB 7F            [ 8] 1129 	bit	7,a
    0000055A 28 01            [12] 1130 	jr	z,ch4_no_more_bytes_this_channel$
                                   1131 
    0000055C                       1132 ch4_one_more_byte$:
                                   1133 
    0000055C 13               [ 8] 1134 	inc	de
                                   1135 
    0000055D                       1136 ch4_no_more_bytes_this_channel$:
                                   1137 
    0000055D C9               [16] 1138 	ret
                                   1139 
    0000055E                       1140 channel4_enabled$:
                                   1141 
                                   1142 	; Channel 4 is enabled
                                   1143 
    0000055E 1A               [ 8] 1144 	ld	a,(de)
    0000055F 13               [ 8] 1145 	inc	de
                                   1146 
    00000560 CB 7F            [ 8] 1147 	bit	7,a
    00000562 20 1B            [12] 1148 	jr	nz,ch4_has_instrument$
                                   1149 
                                   1150 	; Not instrument
                                   1151 
    00000564 CB 77            [ 8] 1152 	bit	6,a
    00000566 20 0E            [12] 1153 	jr	nz,ch4_effects$
                                   1154 
                                   1155 	; Set volume or NOP
                                   1156 
    00000568 CB 6F            [ 8] 1157 	bit	5,a
    0000056A 20 01            [12] 1158 	jr	nz,ch4_just_set_volume$
                                   1159 
                                   1160 	; NOP
                                   1161 
    0000056C C9               [16] 1162 	ret
                                   1163 
    0000056D                       1164 ch4_just_set_volume$:
                                   1165 
                                   1166 	; Set volume
                                   1167 
    0000056D E6 0F            [ 8] 1168 	and	a,#0x0F
    0000056F CB 37            [ 8] 1169 	swap	a
    00000571 EA 03 00         [16] 1170 	ld	(gbt_vol+3),a
                                   1171 
    00000574 18 2A            [12] 1172 	jr	refresh_channel4_regs$
                                   1173 
    00000576                       1174 ch4_effects$:
                                   1175 
                                   1176 	; Set effect
                                   1177 
    00000576 E6 0F            [ 8] 1178 	and	a,#0x0F ; a = effect
                                   1179 
    00000578 CD CF 05         [24] 1180 	call	gbt_channel_4_set_effect
    0000057B A7               [ 4] 1181 	and	a,a
    0000057C C8               [20] 1182 	ret	z ; if 0, don't refresh registers
                                   1183 
    0000057D 18 21            [12] 1184 	jr	refresh_channel4_regs$
                                   1185 
    0000057F                       1186 ch4_has_instrument$:
                                   1187 
                                   1188 	; Has instrument
                                   1189 
    0000057F E6 0F            [ 8] 1190 	and	a,#0x0F
    00000581 21 80 00         [12] 1191 	ld	hl,#gbt_noise
    00000584 4F               [ 4] 1192 	ld	c,a
    00000585 06 00            [ 8] 1193 	ld	b,#0
    00000587 09               [ 8] 1194 	add	hl,bc
    00000588 7E               [ 8] 1195 	ld	a,(hl) ; a = instrument data
                                   1196 
    00000589 EA 03 00         [16] 1197 	ld	(gbt_instr+3),a
                                   1198 
    0000058C 1A               [ 8] 1199 	ld	a,(de)
    0000058D 13               [ 8] 1200 	inc	de
                                   1201 
    0000058E CB 7F            [ 8] 1202 	bit	7,a
    00000590 20 09            [12] 1203 	jr	nz,ch4_instr_and_effect$
                                   1204 
                                   1205 	; Instr + Volume
                                   1206 
    00000592 E6 0F            [ 8] 1207 	and	a,#0x0F ; a = volume
                                   1208 
    00000594 CB 37            [ 8] 1209 	swap	a
    00000596 EA 03 00         [16] 1210 	ld	(gbt_vol+3),a
                                   1211 
    00000599 18 05            [12] 1212 	jr	refresh_channel4_regs$
                                   1213 
    0000059B                       1214 ch4_instr_and_effect$:
                                   1215 
                                   1216 	; Instr + Effect
                                   1217 
    0000059B E6 0F            [ 8] 1218 	and	a,#0x0F ; a = effect
                                   1219 
    0000059D CD CF 05         [24] 1220 	call	gbt_channel_4_set_effect
                                   1221 
                                   1222 	;jr	ch4_refresh_channel4_regs$
                                   1223 
    000005A0                       1224 refresh_channel4_regs$:
                                   1225 
                                   1226 	; fall through!
                                   1227 
                                   1228 ; -----------------
                                   1229 
    000005A0                       1230 channel4_refresh_registers:
                                   1231 
    000005A0 AF               [ 4] 1232 	xor	a,a
    000005A1 EA 20 FF         [16] 1233 	ld	(#.NR41),a
    000005A4 FA 03 00         [16] 1234 	ld	a,(gbt_vol+3)
    000005A7 EA 21 FF         [16] 1235 	ld	(#.NR42),a
    000005AA FA 03 00         [16] 1236 	ld	a,(gbt_instr+3)
    000005AD EA 22 FF         [16] 1237 	ld	(#.NR43),a
    000005B0 3E 80            [ 8] 1238 	ld	a,#0x80 ; start
    000005B2 EA 23 FF         [16] 1239 	ld	(#.NR44),a
                                   1240 
    000005B5 C9               [16] 1241 	ret
                                   1242 
                                   1243 ; ------------------
                                   1244 
    000005B6                       1245 channel4_update_effects: ; returns 1 in a if it is needed to update sound regs
                                   1246 
                                   1247 	; Cut note
                                   1248 	; --------
                                   1249 
    000005B6 FA 03 00         [16] 1250 	ld	a,(gbt_cut_note_tick+3)
    000005B9 21 00 00         [12] 1251 	ld	hl,#gbt_ticks_elapsed
    000005BC BE               [ 8] 1252 	cp	a,(hl)
    000005BD C2 CD 05         [16] 1253 	jp	nz,ch4_dont_cut$
                                   1254 
    000005C0 3D               [ 4] 1255 	dec	a ; a = 0xFF
    000005C1 EA 03 00         [16] 1256 	ld	(gbt_cut_note_tick+3),a ; disable cut note
                                   1257 
    000005C4 AF               [ 4] 1258 	xor	a,a ; vol = 0
    000005C5 EA 21 FF         [16] 1259 	ld	(#.NR42),a
    000005C8 3E 80            [ 8] 1260 	ld	a,#0x80 ; start
    000005CA EA 23 FF         [16] 1261 	ld	(#.NR44),a
                                   1262 
    000005CD                       1263 ch4_dont_cut$:
                                   1264 
    000005CD AF               [ 4] 1265 	xor	a,a
    000005CE C9               [16] 1266 	ret ; a is 0, return
                                   1267 
                                   1268 ; -----------------
                                   1269 
                                   1270 ; returns a = 1 if needed to update registers, 0 if not
    000005CF                       1271 gbt_channel_4_set_effect: ; a = effect, de = pointer to data
                                   1272 
    000005CF 21 DD 05         [12] 1273 	ld	hl,#gbt_ch4_jump_table$
    000005D2 4F               [ 4] 1274 	ld	c,a
    000005D3 06 00            [ 8] 1275 	ld	b,#0
    000005D5 09               [ 8] 1276 	add	hl,bc
    000005D6 09               [ 8] 1277 	add	hl,bc
                                   1278 
    000005D7 2A               [ 8] 1279 	ld	a,(hl+)
    000005D8 66               [ 8] 1280 	ld	h,(hl)
    000005D9 6F               [ 4] 1281 	ld	l,a
                                   1282 
    000005DA 1A               [ 8] 1283 	ld	a,(de) ; load args
    000005DB 13               [ 8] 1284 	inc	de
                                   1285 
    000005DC E9               [ 4] 1286 	jp	(hl)
                                   1287 
    000005DD                       1288 gbt_ch4_jump_table$:
    000005DD FD 05                 1289 	.DW	gbt_ch4_pan$
    000005DF 09 06                 1290 	.DW	gbt_ch1234_nop ; gbt_ch4_arpeggio
    000005E1 04 06                 1291 	.DW	gbt_ch4_cut_note$
    000005E3 09 06                 1292 	.DW	gbt_ch1234_nop
    000005E5 09 06                 1293 	.DW	gbt_ch1234_nop
    000005E7 09 06                 1294 	.DW	gbt_ch1234_nop
    000005E9 09 06                 1295 	.DW	gbt_ch1234_nop
    000005EB 09 06                 1296 	.DW	gbt_ch1234_nop
    000005ED 0B 06                 1297 	.DW	gbt_ch1234_jump_pattern
    000005EF 1C 06                 1298 	.DW	gbt_ch1234_jump_position
    000005F1 2E 06                 1299 	.DW	gbt_ch1234_speed
    000005F3 09 06                 1300 	.DW	gbt_ch1234_nop
    000005F5 09 06                 1301 	.DW	gbt_ch1234_nop
    000005F7 09 06                 1302 	.DW	gbt_ch1234_nop
    000005F9 09 06                 1303 	.DW	gbt_ch1234_nop
    000005FB 09 06                 1304 	.DW	gbt_ch1234_nop
                                   1305 
    000005FD                       1306 gbt_ch4_pan$:
    000005FD E6 88            [ 8] 1307 	and	a,#0x88
    000005FF EA 03 00         [16] 1308 	ld	(gbt_pan+3),a
    00000602 AF               [ 4] 1309 	xor	a,a ; ret 0
    00000603 C9               [16] 1310 	ret ; do not update registers, only NR51 at end.
                                   1311 
    00000604                       1312 gbt_ch4_cut_note$:
    00000604 EA 03 00         [16] 1313 	ld	(gbt_cut_note_tick+3),a
    00000607 AF               [ 4] 1314 	xor	a,a ; ret 0
    00000608 C9               [16] 1315 	ret
                                   1316 
                                   1317 ;-------------------------------------------------------------------------------
                                   1318 
                                   1319 ; Common effects go here:
                                   1320 
    00000609                       1321 gbt_ch1234_nop:
    00000609 AF               [ 4] 1322 	xor	a,a ;ret 0
    0000060A C9               [16] 1323 	ret
                                   1324 
    0000060B                       1325 gbt_ch1234_jump_pattern:
    0000060B EA 00 00         [16] 1326 	ld	(gbt_current_pattern),a
    0000060E AF               [ 4] 1327 	xor	a,a
    0000060F EA 00 00         [16] 1328 	ld	(gbt_current_step),a
    00000612 EA 00 00         [16] 1329 	ld	(gbt_have_to_stop_next_step),a ; clear stop flag
    00000615 3E 01            [ 8] 1330 	ld	a,#1
    00000617 EA 00 00         [16] 1331 	ld	(gbt_update_pattern_pointers),a
    0000061A AF               [ 4] 1332 	xor	a,a ;ret 0
    0000061B C9               [16] 1333 	ret
                                   1334 
    0000061C                       1335 gbt_ch1234_jump_position:
    0000061C EA 00 00         [16] 1336 	ld	(gbt_current_step),a
    0000061F 21 00 00         [12] 1337 	ld	hl,#gbt_current_pattern
    00000622 34               [12] 1338 	inc	(hl)
                                   1339 
                                   1340 	; Check to see if jump puts us past end of song
    00000623 7E               [ 8] 1341 	ld	a,(hl)
    00000624 CD 00 00         [24] 1342 	call	gbt_get_pattern_ptr_banked
    00000627 3E 01            [ 8] 1343 	ld	a,#1 ; tell gbt_player.s to do this next cycle
    00000629 EA 00 00         [16] 1344 	ld	(gbt_update_pattern_pointers),a
    0000062C AF               [ 4] 1345 	xor	a,a ;ret 0
    0000062D C9               [16] 1346 	ret
                                   1347 
    0000062E                       1348 gbt_ch1234_speed:
    0000062E EA 00 00         [16] 1349 	ld	(gbt_speed),a
    00000631 AF               [ 4] 1350 	xor	a,a
    00000632 EA 00 00         [16] 1351 	ld	(gbt_ticks_elapsed),a
    00000635 C9               [16] 1352 	ret ;ret 0
                                   1353 
                                   1354 ;-------------------------------------------------------------------------------
                                   1355 
    00000636                       1356 gbt_update_bank1::
                                   1357 
    00000636 11 00 00         [12] 1358 	ld	de,#gbt_temp_play_data
                                   1359 
                                   1360 	; each function will return in de the pointer to next byte
                                   1361 
    00000639 CD 2C 01         [24] 1362 	call	gbt_channel_1_handle
                                   1363 
    0000063C CD 82 02         [24] 1364 	call	gbt_channel_2_handle
                                   1365 
    0000063F CD D4 03         [24] 1366 	call	gbt_channel_3_handle
                                   1367 
    00000642 CD 43 05         [24] 1368 	call	gbt_channel_4_handle
                                   1369 
                                   1370 	; end of channel handling
                                   1371 
    00000645 21 00 00         [12] 1372 	ld	hl,#gbt_pan
    00000648 2A               [ 8] 1373 	ld	a,(hl+)
    00000649 B6               [ 8] 1374 	or	a,(hl)
    0000064A 23               [ 8] 1375 	inc	hl
    0000064B B6               [ 8] 1376 	or	a,(hl)
    0000064C 23               [ 8] 1377 	inc hl
    0000064D B6               [ 8] 1378 	or	a,(hl)
    0000064E EA 25 FF         [16] 1379 	ld	(#.NR51),a ; handle panning...
                                   1380 
    00000651 C9               [16] 1381 	ret
                                   1382 
                                   1383 ;-------------------------------------------------------------------------------
                                   1384 
    00000652                       1385 gbt_update_effects_bank1::
                                   1386 
    00000652 CD CA 01         [24] 1387 	call	channel1_update_effects
    00000655 A7               [ 4] 1388 	and	a,a
    00000656 C4 AB 01         [24] 1389 	call	nz,channel1_refresh_registers
                                   1390 
    00000659 CD 1C 03         [24] 1391 	call	channel2_update_effects
    0000065C A7               [ 4] 1392 	and	a,a
    0000065D C4 01 03         [24] 1393 	call	nz,channel2_refresh_registers
                                   1394 
    00000660 CD 86 04         [24] 1395 	call	channel3_update_effects
    00000663 A7               [ 4] 1396 	and	a,a
    00000664 C4 42 04         [24] 1397 	call	nz,channel3_refresh_registers
                                   1398 
    00000667 CD B6 05         [24] 1399 	call	channel4_update_effects
    0000066A A7               [ 4] 1400 	and	a,a
    0000066B C4 A0 05         [24] 1401 	call	nz,channel4_refresh_registers
                                   1402 
    0000066E C9               [16] 1403 	ret
                                   1404 
                                   1405 ;-------------------------------------------------------------------------------
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (GameBoy)                  Page 1
Hexadecimal [32-Bits]

Symbol Table

    .NR10   =   0000FF10     |     .NR11   =   0000FF11     |     .NR12   =   0000FF12 
    .NR13   =   0000FF13     |     .NR14   =   0000FF14     |     .NR21   =   0000FF16 
    .NR22   =   0000FF17     |     .NR23   =   0000FF18     |     .NR24   =   0000FF19 
    .NR30   =   0000FF1A     |     .NR31   =   0000FF1B     |     .NR32   =   0000FF1C 
    .NR33   =   0000FF1D     |     .NR34   =   0000FF1E     |     .NR41   =   0000FF20 
    .NR42   =   0000FF21     |     .NR43   =   0000FF22     |     .NR44   =   0000FF23 
    .NR50   =   0000FF24     |     .NR51   =   0000FF25     |     .NR52   =   0000FF26 
    .__.$$$.=   00002710 L   |     .__.ABS.=   00000000 G   |     .__.CPU.=   00000000 L
    .__.H$L.=   00000000 L   |   1 _gbt_get    00000120 R   |   1 ch1_dont    000001E1 R
  1 ch1_freq    0000019B R   |   1 ch1_has_    00000171 R   |   1 ch1_inst    0000015F R
  1 ch1_just    00000156 R   |   1 ch1_more    0000013F R   |   1 ch1_no_m    00000146 R
  1 ch1_not_    00000200 R   |   1 ch1_not_    00000219 R   |   1 ch1_one_    00000145 R
  1 ch2_dont    00000333 R   |   1 ch2_freq    000002F1 R   |   1 ch2_has_    000002C7 R
  1 ch2_inst    000002B5 R   |   1 ch2_just    000002AC R   |   1 ch2_more    00000295 R
  1 ch2_no_m    0000029C R   |   1 ch2_not_    00000352 R   |   1 ch2_not_    0000036B R
  1 ch2_one_    0000029B R   |   1 ch3_dont    000004A2 R   |   1 ch3_effe    00000405 R
  1 ch3_freq    00000434 R   |   1 ch3_has_    0000040E R   |   1 ch3_just    000003FE R
  1 ch3_loop    0000047F R   |   1 ch3_more    000003E7 R   |   1 ch3_no_m    000003EE R
  1 ch3_not_    000004C1 R   |   1 ch3_not_    000004DA R   |   1 ch3_one_    000003ED R
  1 ch4_dont    000005CD R   |   1 ch4_effe    00000576 R   |   1 ch4_has_    0000057F R
  1 ch4_inst    0000059B R   |   1 ch4_just    0000056D R   |   1 ch4_more    00000556 R
  1 ch4_no_m    0000055D R   |   1 ch4_one_    0000055C R   |   1 channel1    00000147 R
  1 channel1    000001AB R   |   1 channel1    000001CA R   |   1 channel2    0000029D R
  1 channel2    00000301 R   |   1 channel2    0000031C R   |   1 channel3    000003EF R
  1 channel3    00000442 R   |   1 channel3    00000486 R   |   1 channel4    0000055E R
  1 channel4    000005A0 R   |   1 channel4    000005B6 R   |     gbt_arpe    ******** GX
    gbt_arpe    ******** GX  |     gbt_arpe    ******** GX  |   1 gbt_ch12    0000060B R
  1 gbt_ch12    0000061C R   |   1 gbt_ch12    00000609 R   |   1 gbt_ch12    0000062E R
  1 gbt_ch1_    00000262 R   |   1 gbt_ch1_    0000027D R   |   1 gbt_ch1_    0000023B R
  1 gbt_ch1_    0000025B R   |   1 gbt_ch2_    000003B4 R   |   1 gbt_ch2_    000003CF R
  1 gbt_ch2_    0000038D R   |   1 gbt_ch2_    000003AD R   |   1 gbt_ch3_    00000523 R
  1 gbt_ch3_    0000053E R   |   1 gbt_ch3_    000004FC R   |   1 gbt_ch3_    0000051C R
  1 gbt_ch4_    00000604 R   |   1 gbt_ch4_    000005DD R   |   1 gbt_ch4_    000005FD R
  1 gbt_chan    0000046F R   |     gbt_chan    ******** GX  |   1 gbt_chan    0000012C GR
  1 gbt_chan    0000022D R   |   1 gbt_chan    00000282 GR  |   1 gbt_chan    0000037F R
  1 gbt_chan    000003D4 GR  |   1 gbt_chan    000004EE R   |   1 gbt_chan    00000543 GR
  1 gbt_chan    000005CF R   |     gbt_chan    ******** GX  |     gbt_curr    ******** GX
    gbt_curr    ******** GX  |     gbt_cut_    ******** GX  |     gbt_freq    ******** GX
  1 gbt_freq    00000090 R   |     gbt_get_    ******** GX  |     gbt_have    ******** GX
    gbt_inst    ******** GX  |   1 gbt_nois    00000080 R   |     gbt_pan     ******** GX
    gbt_spee    ******** GX  |     gbt_temp    ******** GX  |     gbt_tick    ******** GX
  1 gbt_upda    00000636 GR  |   1 gbt_upda    00000652 GR  |     gbt_upda    ******** GX
    gbt_vol     ******** GX  |   1 gbt_wave    00000000 R   |   1 refresh_    000001AB R
  1 refresh_    00000301 R   |   1 refresh_    00000442 R   |   1 refresh_    000005A0 R

ASxxxx Assembler V02.00 + NoICE + SDCC mods  (GameBoy)                  Page 2
Hexadecimal [32-Bits]

Area Table

   0 _CODE      size        0   flags    0
   1 _CODE_1    size      66F   flags    0

